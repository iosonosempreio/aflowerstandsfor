(this["webpackJsonpcovi-z"]=this["webpackJsonpcovi-z"]||[]).push([[0],{100:function(e,t,n){"use strict";n.r(t);var a,i,o=n(0),r=n.n(o),c=n(53),s=n.n(c),l=(n(84),n(25)),d=n(15),u=(n(85),n(4)),h=n(5),m=n(8),p=n(3),f=n(7),g=n(2),y=n(54),v=n.n(y),w={emoji:{size:20},clampZoomOptions:{minScale:.5,maxScale:15},emoji_dictionary:{dimessi_guariti:"\ud83c\udf40",isolamento_domiciliare:"\u26aa\ufe0f",ricoverati_con_sintomi:"\ud83c\udf3c",terapia_intensiva:"\ud83c\udf38",deceduti:"\ud83c\udf3a"},emoji_images_dictionary:{dimessi_guariti:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/four-leaf-clover_1f340.png",isolamento_domiciliare:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/blossom_1f33c.png",ricoverati_con_sintomi:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/sunflower_1f33b.png",terapia_intensiva:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/cherry-blossom_1f338.png",deceduti:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/hibiscus_1f33a.png"},categories:["deceduti","terapia_intensiva","ricoverati_con_sintomi","isolamento_domiciliare","dimessi_guariti"],map:{width:768,height:1024,scale:8e3}},x=w,_=g.f().stop(),j=x.emoji.size/x.clampZoomOptions.maxScale,b=[],k=JSON.parse(JSON.stringify(x.categories)),E=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(m.a)(this,Object(p.a)(t).call(this,e))).state={data:[]},n}return Object(f.a)(t,e),Object(h.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e,i=g.i().fitSize([x.map.width-50,x.map.height-50],this._rootNode).translate([x.map.width/2,x.map.height/2]).scale(x.map.scale).center([12.368775000000001,42.9451139])}},{key:"componentDidMount",value:function(){var e=this;g.a("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv").then((function(t){var n=g.l().key((function(e){return e.data})).entries(t);console.log(n);var o={};n.forEach((function(e){var t=e.key,n=e.values;n.forEach((function(e){var t=i([e.long,e.lat]);e.x=t[0],e.y=t[1]})),o[t]=[],n.forEach((function(e,n){x.categories.forEach((function(n){for(var a=0;a<e[n];++a){var i={id:e.denominazione_regione+"-"+n+"-"+a+1,category:n,denominazione_regione:e.denominazione_regione,date:e.data,_x:e.x,_y:e.y,x:e.x,y:e.y};o[t].push(i)}}))}))})),e.setState({data:o},(function(){var t=g.n(e._rootNode),n=t.append("g");var i=g.o().extent([[0,0],[window.innerWidth,window.innerHeight]]).scaleExtent([x.clampZoomOptions.minScale,2*x.clampZoomOptions.maxScale]).on("zoom",(function(){n.attr("transform",g.c.transform)}));t.call(i),t.call(i.transform,g.p.translate(-5,-340).scale(5)),a=n.selectAll("text"),_.nodes(b).tick(1e3).on("tick",(function(){document.title=_.alpha(),a.attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y}))})).force("x",g.g((function(e){return e._x}))).force("y",g.h((function(e){return e._y}))).force("charge",g.e().strength(-.05)).alphaDecay(.01).alphaMin(.1);var o=Object.keys(e.state.data);!function t(){var n=o.shift();console.log(n);var a=e.state.data[n];console.log(a),k=JSON.parse(JSON.stringify(x.categories)),b=O(b,a,k.shift()),z(),_.force("collision",null),_.on("end",(function(){document.title="simulation ended",k.length>0?(b=O(b,a,k.shift()),z()):(document.title="running anticollision",console.log("running anticollision"),_.force("collision",g.d(x.emoji.size/x.clampZoomOptions.maxScale/2*.9).strength(.1)),_.alpha(1).restart().on("end",(function(){console.log("done anticollision, missing",o.length),o.length>0?(b.forEach((function(e){delete e.x,delete e.y,delete e.index,delete e.vx,delete e.vy,delete e.fx,delete e.fy})),b=[],t()):P(e.state.data)})))}))}()}))})),document.addEventListener("keypress",(function(e){"r"===e.key?_.alpha(1).restart():"\\"===e.key?_.alpha(1e-5).restart():"c"===e.key||99===e.keyCode?(b.forEach((function(e){e.fx=null,e.fy=null})),_.force("collision",g.d(x.emoji.size/x.clampZoomOptions.maxScale/2*.9).strength(.1)),_.alpha(1).restart()):"d"===e.key&&P(b)}))}},{key:"render",value:function(){return r.a.createElement("svg",{ref:this._setRef.bind(this),style:{width:"100%",height:"100%"}})}}]),t}(o.Component),O=function(e,t,n){e.forEach((function(e){e.fx=e.x,e.fy=e.y}));var a=t.filter((function(e){return e.category===n})),i=360/a.length*20,o=2*Math.sqrt((a.length+e.length)/Math.PI);return a.forEach((function(e,t){e.x=e._x+Math.cos(Math.PI/180*t*i)*(o+t/80)+g.m(-5,5)(),e.y=e._y+Math.sin(Math.PI/180*t*i)*(o+t/80)+g.m(-5,5)()})),e.concat(a)},z=function(){(a=a.data(b,(function(e){return e.id}))).exit().remove(),a=a.enter().append("text").classed("node",!0).attr("font-size",j+"px").text((function(e){return x.emoji_dictionary[e.category]})).attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y})).call(g.b().on("start",S).on("drag",N).on("end",C)).merge(a),_.nodes(b).alpha(1).restart()};function S(e){g.c.active||_.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function N(e){e.fx=g.c.x,e.fy=g.c.y}function C(e){g.c.active||_.alphaTarget(0),e.fx=null,e.fy=null}function P(e){for(var t=0;t<e.length;++t)e[t]._x=e[t].x,e[t]._y=e[t].y,delete e[t].index,delete e[t].vx,delete e[t].vy,delete e[t].x,delete e[t].y;var n=new Blob([JSON.stringify(e)],{type:"application/json;charset=utf-8"});v.a.saveAs(n,"covi-z-storico.json")}var W,D,Z,A,M=n(13),H=n(1),I=n(56),J=n(57),R=n.n(J),B=0,L=window.innerWidth,V=window.innerHeight,q=window.devicePixelRatio||1,F=x.emoji.size,G=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(m.a)(this,Object(p.a)(t).call(this,e))).loadData=n.loadData.bind(Object(M.a)(n)),n.loadEmoji=n.loadEmoji.bind(Object(M.a)(n)),n.initPixiApp=n.initPixiApp.bind(Object(M.a)(n)),n.state={textures:{}},n}return Object(f.a)(t,e),Object(h.a)(t,[{key:"loadData",value:function(){return Promise.all([g.k("./data/covi-z.json"),g.k("./data/regioni.geojson")])}},{key:"initPixiApp",value:function(){var e=this;this.loadData().then((function(t){var n=t[0],a=t[1];W=new H.Application({width:L,height:V,backgroundColor:16448250,resolution:q,autoResize:!0}),e._rootNode.appendChild(W.view),(D=new I.a({center:new H.Point(-window.innerWidth/2,-window.innerHeight/2),passiveWheel:!1,stopPropagation:!0,divWheel:e._rootNode,screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:window.innerWidth,worldHeight:window.innerHeight,interaction:W.renderer.plugins.interaction})).clampZoom(x.clampZoomOptions).drag({pressDrag:!0,clampWheel:!0}).pinch().wheel(),W.stage.addChild(D),A=g.i().fitSize([x.map.width-50,x.map.height-50],e._rootNode).translate([x.map.width/2,x.map.height/2]).scale(x.map.scale).center([12.368775000000001,42.9451139]);for(var i=0;i<a.features.length;i++){var o=a.features[i],r=new H.Graphics,c=g.j().projection(A).context(r);r.beginFill(16777215,1),r.lineStyle(.25,13421772),c(o),r.endFill(),D.addChild(r)}Z=new H.Container,D.addChild(Z);for(var s=0;s<n.length;++s){var l=H.Sprite.from(e.state.textures[n[s].category]);l.anchor.set(.5),l.x=n[s]._x,l.y=n[s]._y,l.scale.x=1/q/x.clampZoomOptions.maxScale,l.scale.y=1/q/x.clampZoomOptions.maxScale,Z.addChild(l)}}))}},{key:"componentDidMount",value:function(){}},{key:"loadEmoji",value:function(){var e=this;++B===Object.keys(x.emoji_images_dictionary).length&&function(){for(var t=document.querySelectorAll("#textures-generation>*"),n={},a=function(a){R()(t[a],{backgroundColor:null}).then((function(i){n[t[a].id]=i.toDataURL("image/png"),Object.keys(n).length===Object.keys(x.emoji_dictionary).length&&e.setState({textures:n},(function(){e.initPixiApp()}))}))},i=0;i<t.length;++i)a(i)}()}},{key:"_setRef",value:function(e){this._rootNode=e}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{style:{width:"100%",height:"100%"},ref:this._setRef.bind(this)},r.a.createElement("div",{id:"textures-generation",style:{position:"absolute",top:"10px"}},Object.keys(x.emoji_images_dictionary).map((function(t){return r.a.createElement("img",{id:t,key:"emoji-".concat(t),style:{width:F+"px"},src:"./".concat(t,".png"),onLoad:e.loadEmoji})}))))}}]),t}(o.Component);var T=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(l.a,{basename:"/"},r.a.createElement(d.a,{exact:!0,path:"/"},r.a.createElement("nav",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l.b,{to:"/svg"},"SVG Version")),r.a.createElement("li",null,r.a.createElement(l.b,{to:"/pixi"},"PIXIjs version"))))),r.a.createElement(d.a,{path:"/svg"},r.a.createElement(E,null)),r.a.createElement(d.a,{path:"/pixi"},r.a.createElement(G,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(T,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},79:function(e,t,n){e.exports=n(100)},84:function(e,t,n){},85:function(e,t,n){}},[[79,1,2]]]);
//# sourceMappingURL=main.47848244.chunk.js.map