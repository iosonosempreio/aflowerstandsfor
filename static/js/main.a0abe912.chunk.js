(this["webpackJsonpcovi-z"]=this["webpackJsonpcovi-z"]||[]).push([[0],{104:function(e,t,n){"use strict";n.r(t);var i,a,o,r,c,s=n(0),l=n.n(s),d=n(55),u=n.n(d),m=(n(87),n(25)),h=n(15),p=(n(88),n(31)),f=n.n(p),g=n(56),w=n(3),v=n(4),_=n(7),y=n(2),x=n(8),b=n(6),j=n(57),k=n.n(j),z={emoji:{size:20},clampZoomOptions:{minScale:.5,maxScale:10},emoji_dictionary:{dimessi_guariti:"\ud83c\udf40",isolamento_domiciliare:"\ud83c\udfe0",ricoverati_con_sintomi:"\ud83c\udf3c",terapia_intensiva:"\ud83c\udf38",deceduti:"\ud83c\udf37"},emoji_images_dictionary:{dimessi_guariti:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/four-leaf-clover_1f340.png",isolamento_domiciliare:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/blossom_1f33c.png",ricoverati_con_sintomi:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/sunflower_1f33b.png",terapia_intensiva:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/cherry-blossom_1f338.png",deceduti:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/hibiscus_1f33a.png"},categories:["ricoverati_con_sintomi","terapia_intensiva","isolamento_domiciliare","dimessi_guariti","deceduti"],map:{width:768,height:1024}},O=z,E=b.d().stop(),S=O.emoji.size/O.clampZoomOptions.maxScale,W=function(e){function t(e){var n;return Object(w.a)(this,t),(n=Object(_.a)(this,Object(y.a)(t).call(this,e))).state={data:[]},n}return Object(x.a)(t,e),Object(v.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e}},{key:"componentDidMount",value:function(){var e=this;b.a("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv").then((function(t){var n=b.j().key((function(e){return e.data})).entries(t),a=n[n.length-1].values,o=[];i=b.g().fitSize([O.map.width-50,O.map.height-50],e._rootNode).translate([O.map.width/2,O.map.height/2]).scale(3e3).center([12.368775000000001,42.9451139]),a.forEach((function(e){var t=i([e.long,e.lat]);e.x=t[0],e.y=t[1]}));for(var r=function(e){O.categories.forEach((function(t){for(var n=0;n<a[e][t];++n){var i={category:t,denominazione_regione:a[e].denominazione_regione,date:a[e].data,_x:a.find((function(t){return t.denominazione_regione===a[e].denominazione_regione})).x,_y:a.find((function(t){return t.denominazione_regione===a[e].denominazione_regione})).y,x:a.find((function(t){return t.denominazione_regione===a[e].denominazione_regione})).x+b.k(-50,50)(),y:a.find((function(t){return t.denominazione_regione===a[e].denominazione_regione})).y+b.k(-50,50)()};o.push(i)}}))},c=0;c<a.length;++c)r(c);e.setState({raw_data:a,data:o},(function(){var t=b.l(e._rootNode),n=t.append("g");t.call(b.m().extent([[0,0],[window.innerWidth,window.innerHeight]]).scaleExtent([O.clampZoomOptions.minScale,O.clampZoomOptions.maxScale]).on("zoom",(function(){n.attr("transform",b.b.transform)})));var i=n.selectAll("text").data(e.state.data).enter().append("text").attr("font-size",S+"px").text((function(e){return O.emoji_dictionary[e.category]})),a=window.prompt("Set the alpha decay of force simulation, once finished it will generate a JSON with the spatialized positions",.05);E.nodes(o).force("x",b.e((function(e){return e._x}))).force("y",b.f((function(e){return e._y}))).force("charge",b.c().strength(-.05)).alphaDecay(a).alpha(1).on("end",(function(){console.log("ended",o,E),r=!1,i.attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y}));for(var e=0;e<o.length;++e)console.log(e),o[e]._x=o[e].x,o[e]._y=o[e].y,delete o[e].index,delete o[e].vx,delete o[e].vy,delete o[e].x,delete o[e].y;var t=new Blob([JSON.stringify(o)],{type:"application/json;charset=utf-8"});k.a.saveAs(t,"covi-z.json")})).restart();var r=!0;!function e(){r&&(document.title="a = "+E.alpha(),i.attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y})),requestAnimationFrame(e))}(),document.addEventListener("keypress",function(){var e=Object(g.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"r"===t.key&&E.alpha(1).restart();case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))}))}},{key:"render",value:function(){return l.a.createElement("svg",{ref:this._setRef.bind(this),style:{width:"100%",height:"100%"}})}}]),t}(s.Component),C=n(13),A=n(1),D=n(59),N=n(60),P=n.n(N),Z=0,H=window.innerWidth,R=window.innerHeight,I=window.devicePixelRatio||1,J=O.emoji.size,B=function(e){function t(e){var n;return Object(w.a)(this,t),(n=Object(_.a)(this,Object(y.a)(t).call(this,e))).loadData=n.loadData.bind(Object(C.a)(n)),n.loadEmoji=n.loadEmoji.bind(Object(C.a)(n)),n.initPixiApp=n.initPixiApp.bind(Object(C.a)(n)),n.state={textures:{}},n}return Object(x.a)(t,e),Object(v.a)(t,[{key:"loadData",value:function(){return Promise.all([b.i("./data/covi-z.json"),b.i("./data/regioni.geojson")])}},{key:"initPixiApp",value:function(){var e=this;this.loadData().then((function(t){var n=t[0],i=t[1];a=new A.Application({width:H,height:R,backgroundColor:16448250,resolution:I,autoResize:!0}),e._rootNode.appendChild(a.view),(o=new D.a({center:new A.Point(-window.innerWidth/2,-window.innerHeight/2),passiveWheel:!1,stopPropagation:!0,divWheel:e._rootNode,screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:window.innerWidth,worldHeight:window.innerHeight,interaction:a.renderer.plugins.interaction})).clampZoom(O.clampZoomOptions).drag({pressDrag:!0,clampWheel:!0}).pinch().wheel(),a.stage.addChild(o),c=b.g().fitSize([O.map.width-50,O.map.height-50],e._rootNode).translate([O.map.width/2,O.map.height/2]).scale(3e3).center([12.368775000000001,42.9451139]);for(var s=0;s<i.features.length;s++){var l=i.features[s],d=new A.Graphics,u=b.h().projection(c).context(d);d.beginFill(16777215,1),d.lineStyle(.25,13421772),u(l),d.endFill(),o.addChild(d)}r=new A.Container,o.addChild(r);for(var m=0;m<n.length;++m){var h=A.Sprite.from(e.state.textures[n[m].category]);h.anchor.set(.5),h.x=n[m]._x,h.y=n[m]._y,h.scale.x=1/I/O.clampZoomOptions.maxScale,h.scale.y=1/I/O.clampZoomOptions.maxScale,r.addChild(h)}}))}},{key:"componentDidMount",value:function(){}},{key:"loadEmoji",value:function(){var e=this;++Z===Object.keys(O.emoji_images_dictionary).length&&function(){for(var t=document.querySelectorAll("#textures-generation>*"),n={},i=function(i){P()(t[i],{backgroundColor:null}).then((function(a){n[t[i].id]=a.toDataURL("image/png"),Object.keys(n).length===Object.keys(O.emoji_dictionary).length&&e.setState({textures:n},(function(){e.initPixiApp()}))}))},a=0;a<t.length;++a)i(a)}()}},{key:"_setRef",value:function(e){this._rootNode=e}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{style:{width:"100%",height:"100%"},ref:this._setRef.bind(this)},l.a.createElement("div",{id:"textures-generation",style:{position:"absolute",top:"10px"}},Object.keys(O.emoji_images_dictionary).map((function(t){return l.a.createElement("img",{id:t,key:"emoji-".concat(t),style:{width:J+"px"},src:"./".concat(t,".png"),onLoad:e.loadEmoji})}))))}}]),t}(s.Component);var F=function(){return l.a.createElement("div",{className:"App"},l.a.createElement(m.a,{basename:"/"},l.a.createElement(h.a,{path:"/svg"},l.a.createElement(W,null)),l.a.createElement(h.a,{path:"/pixi"},l.a.createElement(B,null)),l.a.createElement(h.a,{exact:!0,path:"/"},l.a.createElement("nav",null,l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement(m.b,{to:"/svg"},"SVG Version")),l.a.createElement("li",null,l.a.createElement(m.b,{to:"/pixi"},"PIXIjs version")))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(l.a.createElement(F,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},82:function(e,t,n){e.exports=n(104)},87:function(e,t,n){},88:function(e,t,n){}},[[82,1,2]]]);
//# sourceMappingURL=main.a0abe912.chunk.js.map