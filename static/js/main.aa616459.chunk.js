(this["webpackJsonpcovi-z"]=this["webpackJsonpcovi-z"]||[]).push([[0],{124:function(e,t,i){e.exports=i(161)},129:function(e,t,i){},130:function(e,t,i){},161:function(e,t,i){"use strict";i.r(t);var n,a,r,o,s,c,l,d,u,h,m,p=i(0),f=i.n(p),v=i(88),_=i.n(v),g=(i(129),i(23)),w=i(16),y=(i(130),i(9)),b=i.n(y),x=i(12),k=i(3),j=i(4),L=i(7),P=i(5),O=i(6),N=i(2),E=i(30),C=(i(132),{emoji:{size:20},clampZoomOptions:{minScale:.01,maxScale:7},emoji_dictionary:{dimessi_guariti:"\ud83c\udf40",isolamento_domiciliare:"\u26aa\ufe0f",ricoverati_con_sintomi:"\ud83c\udf3c",terapia_intensiva:"\ud83c\udf38",deceduti:"\ud83c\udf3a"},emoji_images_dictionary:{dimessi_guariti:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/four-leaf-clover_1f340.png",isolamento_domiciliare:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/blossom_1f33c.png",ricoverati_con_sintomi:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/sunflower_1f33b.png",terapia_intensiva:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/cherry-blossom_1f338.png",deceduti:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/hibiscus_1f33a.png"},categories:["deceduti","terapia_intensiva","ricoverati_con_sintomi","isolamento_domiciliare","dimessi_guariti"],categories_en:["deceased","intensive_care","hospitalized","home_isolation","recovered"],category2english:{deceduti:"deceased",terapia_intensiva:"intensive_care",ricoverati_con_sintomi:"hospitalized",isolamento_domiciliare:"home_isolation",dimessi_guariti:"recovered"},map:{width:768,height:1024,scale:3e4},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}}),z=C,D=[{region_name:"Abruzzo",lat:"42.216666666667",lon:"13.833333333333"},{region_name:"Valle d'Aosta",lat:"45.716666666667",lon:"7.3666666666667"},{region_name:"Puglia",lat:"41.008611111111",lon:"16.512777777778"},{region_name:"Basilicata",lat:"40.5",lon:"16.5"},{region_name:"Calabria",lat:"39",lon:"16.5"},{region_name:"Campania",lat:"40.75",lon:"14.783333333333"},{region_name:"Emilia-Romagna",lat:"44.75",lon:"11"},{region_name:"Friuli Venezia Giulia",lat:"46.1",lon:"13.116666666667"},{region_name:"Lazio",lat:"41.9",lon:"12.716666666667"},{region_name:"Liguria",lat:"44.45",lon:"8.7666666666667"},{region_name:"Lombardia",lat:"45.65",lon:"9.95"},{region_name:"Marche",lat:"43.316666666667",lon:"13"},{region_name:"Molise",lat:"41.6997",lon:"14.6111"},{region_name:"Piemonte",lat:"45.25",lon:"7.9166666666667"},{region_name:"Sardegna",lat:"40.05",lon:"9.0833333333333"},{region_name:"Sicilia",lat:"37.599958333333",lon:"14.015377777778"},{region_name:"Trentino-Alto Adige",lat:"46.383333333333",lon:"11.416666666667"},{region_name:"Toscana",lat:"43.35",lon:"11.016666666667"},{region_name:"Umbria",lat:"42.983333333333",lon:"12.566666666667"},{region_name:"Veneto",lat:"45.733333333333",lon:"11.85"}],S={deceduti:"deceased",terapia_intensiva:"intensive_cares",ricoverati_con_sintomi:"hospitalized",isolamento_domiciliare:"home_isolation",dimessi_guariti:"recovered"},T={deceduti:"1",terapia_intensiva:"2",ricoverati_con_sintomi:"3",isolamento_domiciliare:"4",dimessi_guariti:"5"},A=(N.f().stop(),{}),M=N.i(),B=N.j().projection(M),W=N.o().exponent(.5),R=N.n(N.p),I=function(e){function t(e){return Object(k.a)(this,t),Object(L.a)(this,Object(P.a)(t).call(this,e))}return Object(O.a)(t,e),Object(j.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e}},{key:"componentDidMount",value:function(){var e=Object(x.a)(b.a.mark((function e(){var t,i,r,o,s,c,l,d,u,h,m,p,f,v;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v=function(e){for(var t=e.length-1;t>0;t--){var i=Math.floor(Math.random()*(t+1)),n=[e[i],e[t]];e[t]=n[0],e[i]=n[1]}return e},f=function(e){A[e].filter((function(e){return"Lombardia"===e.denominazione_regione})).forEach((function(t){var i=d[e].filter((function(e){return e.id.toString().substring(0,2)===t.code}));console.log(i.length),v(i);var n=u[e].filter((function(e){return e.source.toString().substring(0,2)===t.code})),a=N.f(i).force("center",N.c(0,0)).force("links",N.e([]).id((function(e){return e.id})).distance(0)).force("collision",N.d(.45)).force("x",N.g().strength(.09)).force("y",N.h().strength(.09)).on("tick",(function(){document.title=a.alpha(),r.attr("cx",(function(e){return e.x})).attr("cy",(function(e){return e.y}))})).alpha(1).on("end",(function(){console.log(t.denominazione_regione,"simulation ended"),r.attr("cx",(function(e){return e.x})).attr("cy",(function(e){return e.y})),i.forEach((function(e){e.bunches_x=e.x,e.bunches_y=e.y})),a.force("links").links(n),a.alpha(1).restart().on("tick",(function(){document.title=a.alpha(),r.attr("cx",(function(e){return e.x})).attr("cy",(function(e){return e.y}))})).on("end",(function(){document.title="simulation ended",r.attr("cx",(function(e){return e.x})).attr("cy",(function(e){return e.y})),i.forEach((function(e){e.clusters_x=e.x,e.clusters_y=e.y})),console.log(t.denominazione_regione,"simulation clusters ended")}))})),r=p.append("g").attr("transform","translate("+t.x+","+t.y+")").attr("class",t.code).selectAll(".flower");r=r.data(i,(function(e){return e.id})).enter().append("circle").classed("flower",!0).attr("r",.5).attr("fill",(function(e){return R(e.id.toString().substring(2,4))})).style("opacity",.7).attr("cx",t.x).attr("cy",t.y)}))},t=N.q(this._rootNode),i=t.append("g"),r=N.r().on("zoom",(function(){i.attr("transform",N.b.transform)})),t.call(r),e.next=8,N.k("./data/world-50m.json");case 8:return o=e.sent,s=E.a(o,o.objects.countries),c=s.features.find((function(e){return"380"===e.id})),M.fitExtent([[5,5],[758,1014]],c),(n=(n=i.append("g").attr("class","countries").selectAll(".country")).data(s.features)).exit().remove(),n.enter().append("path").classed("country",!0).merge(n).attr("d",B).attr("fill","#fafafa").attr("stroke","#eef3bd").attr("stroke-width","0.5px"),e.next=18,N.a("./data/dpc-covid19-ita-regioni.csv");case 18:l=e.sent,d={},u={},h=N.m().key((function(e){return e.data})).entries(l),m="2020-03-01T17:00:00",(h=h.filter((function(e){return e.key===m}))).forEach((function(e){d[e.key]=[],u[e.key]=[],A[e.key]=[];var t=e.values,i=t.filter((function(e){return"04"===e.codice_regione})),n={data:e.key,stato:"ITA",codice_regione:"04",denominazione_regione:"Trentino-Alto Adige",lat:"46.49933453",long:"11.35662422",ricoverati_con_sintomi:Number(i[0].ricoverati_con_sintomi)+Number(i[1].ricoverati_con_sintomi),terapia_intensiva:Number(i[0].terapia_intensiva)+Number(i[1].terapia_intensiva),totale_ospedalizzati:Number(i[0].totale_ospedalizzati)+Number(i[1].totale_ospedalizzati),isolamento_domiciliare:Number(i[0].isolamento_domiciliare)+Number(i[1].isolamento_domiciliare),totale_positivi:Number(i[0].totale_positivi)+Number(i[1].totale_positivi),variazione_totale_positivi:Number(i[0].variazione_totale_positivi)+Number(i[1].variazione_totale_positivi),nuovi_positivi:Number(i[0].nuovi_positivi)+Number(i[1].nuovi_positivi),dimessi_guariti:Number(i[0].dimessi_guariti)+Number(i[1].dimessi_guariti),deceduti:Number(i[0].deceduti)+Number(i[1].deceduti),totale_casi:Number(i[0].totale_casi)+Number(i[1].totale_casi),tamponi:Number(i[0].tamponi)+Number(i[1].tamponi),note_it:"",note_en:""},a=t.indexOf(i[0]);t.splice(a,1);var r=t.indexOf(i[1]);t.splice(r,1),t.push(n),t.forEach((function(t){t.code=t.codice_regione,t.total=t.totale_casi,t.center_x=D.find((function(e){return e.region_name===t.denominazione_regione})).lon,t.center_y=D.find((function(e){return e.region_name===t.denominazione_regione})).lat;var i=M([t.center_x,t.center_y]);t.x=i[0],t.y=i[1],delete t.data,delete t.codice_regione,delete t.stato,delete t.lat,delete t.long,delete t.totale_casi,delete t.totale_ospedalizzati,delete t.totale_positivi,delete t.variazione_totale_positivi,delete t.nuovi_positivi,delete t.tamponi,delete t.note_it,delete t.note_en,A[e.key].push(t),Object.keys(S).forEach((function(i){for(var n=0;n<t[i];++n){var a={id:t.code.toString()+""+T[i]+n.toString().padStart(6,"0")};if(d[e.key].push(a),0===n)for(var r=1;r<Number(T[i]);++r){var o={source:t.code.toString()+""+r+"0".toString().padStart(6,"0"),target:a.id};u[e.key].push(o)}else{var s={source:t.code.toString()+""+T[i]+"0".toString().padStart(6,"0"),target:a.id};u[e.key].push(s)}}}))}))})),W.range([0,35]).domain([0,N.l(A[m],(function(e){return e.total}))]),a=(a=i.selectAll(".region")).data(A[m],(function(e){return e.code})).enter().append("circle").attr("class",(function(e){return e.denominazione_regione})).attr("fill","white").attr("stroke","#cccccc").classed("region",!0).attr("r",(function(e){return W(+e.total)})),N.f(A[m]).force("x",N.g((function(e){return e.x}))).force("y",N.h((function(e){return e.y}))).force("collision",N.d((function(e){return W(e.total)}))).on("tick",(function(){a.attr("cx",(function(e){return e.x})).attr("cy",(function(e){return e.y}))})).on("end",(function(){f(m)})).alpha(1).restart(),p=i.append("g").classed("flowers",!0);case 30:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return f.a.createElement("svg",{ref:this._setRef.bind(this),style:{width:"768px",height:"1024px",backgroundColor:"#eef3bd"}})}}]),t}(p.Component),q=i(1),H=i(20),F=window.devicePixelRatio||1,G=[],V=0,U=(N.i().translate([z.map.width/2,z.map.height/2]).scale(z.map.scale).center([12.368775000000001,42.9451139]),function(e){function t(e){var i;return Object(k.a)(this,t),(i=Object(L.a)(this,Object(P.a)(t).call(this,e))).state={viewBuffer:null},i}return Object(O.a)(t,e),Object(j.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e}},{key:"componentDidMount",value:function(){var e=this;r=window.innerWidth/F,o=window.innerHeight/F;var t=Object.keys(this.props.unique_IDS).length;console.log("amount:",t),s=new q.Application({width:r,height:o,backgroundColor:16056305,resolution:F,powerPreference:"high-performance"}),this._rootNode.appendChild(s.view);var i=new H.a({passiveWheel:!1,stopPropagation:!0,divWheel:this._rootNode,screenWidth:r,screenHeight:o,worldWidth:r,worldHeight:o,interaction:s.renderer.plugins.interaction});i.drag({pressDrag:!0,clampWheel:!0}).pinch().wheel(),s.stage.addChild(i);var n=new q.ParticleContainer(t,{vertices:!1,position:!0,rotation:!1,uvs:!1,tint:!1});i.addChild(n);var a={};s.loader.add("sprites","./flowers-textures-ita-1.png"),s.loader.onProgress.add((function(e){console.log(e.progress+"%")})),s.loader.onComplete.add(Object(x.a)(b.a.mark((function t(){var r,o,c,l,d,u,h,m;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("loader completed"),r=s.loader.resources.sprites.texture.baseTexture,t.next=4,N.k("./flowers-textures-ita-1.json");case 4:for(c in(o=t.sent).frames)l=o.frames[c].frame,d=new q.Texture(r,new q.Rectangle(l.x,l.y,l.w,l.h)),a[c.replace(".png","")]=d;for(h in u={},e.props.unique_IDS)(m=new Y(a[e.props.unique_IDS[h].category])).x=Number(e.props.unique_IDS[h].position.x),m.y=Number(e.props.unique_IDS[h].position.y),m.anchor.x=.5,m.anchor.y=.5,m.scale.x=.125,m.scale.y=.125,u[h]=m;e.state.viewBuffer=new X(u,n),e.state.viewBuffer.setDrawList(e.props.data,e.props.model),e.state.viewBuffer.drawObjects(),V=Date.now(),function e(){var t=(Date.now()-V)/1e3;V=Date.now();for(var n=0;n<G.length;++n)G[n](t);s.renderer.render(i),requestAnimationFrame(e)}();case 14:case"end":return t.stop()}}),t)})))),s.loader.load()}},{key:"componentDidUpdate",value:function(e){e.data!==this.props.data?(this.state.viewBuffer.clearObjects(),this.state.viewBuffer.setDrawList(this.props.data,this.props.model),this.state.viewBuffer.drawObjects()):e.model!==this.props.model&&(this.state.viewBuffer.model=this.props.model,this.state.viewBuffer.startAnimation(5,s))}},{key:"render",value:function(){return f.a.createElement("div",{style:{width:"100vw",height:"100vh"},ref:this._setRef.bind(this)})}}]),t}(p.Component)),X=function(){function e(t,i){Object(k.a)(this,e),this.master={},this.drawList=[],this.animationTime=0,this.timeLeft=0,this.app=null,this.container=null,this.model=null,this.master=t,this.container=i}return Object(j.a)(e,[{key:"setDrawList",value:function(e,t){this.drawList=e,this.model=t}},{key:"clearObjects",value:function(){this.container.removeChildren()}},{key:"drawObjects",value:function(){if("stripes"!==this.model)for(var e=0;e<this.drawList.length;++e)this.master[this.drawList[e].id].position.x=Number(this.drawList[e][this.model+"_x"]),this.master[this.drawList[e].id].position.y=Number(this.drawList[e][this.model+"_y"]),this.container.addChild(this.master[this.drawList[e].id]);else for(var t=0;t<this.drawList.length;++t)this.master[this.drawList[t].id].position.x=Number(this.drawList[t][this.model+"_x"])*r,this.master[this.drawList[t].id].position.y=Number(this.drawList[t][this.model+"_y"])*o,this.container.addChild(this.master[this.drawList[t].id])}},{key:"startAnimation",value:function(e,t){if(this.animationTime=e,this.timeLeft=0,this.app=t,"stripes"===this.model)for(var i=0;i<this.drawList.length;++i){var n=new q.Point;n.x=Number(this.drawList[i][this.model+"_x"])*r,n.y=Number(this.drawList[i][this.model+"_y"])*o,this.master[this.drawList[i].id].setLastPoint(),this.master[this.drawList[i].id].setNextPoint(n)}else for(var a=0;a<this.drawList.length;++a){var s=new q.Point;s.x=Number(this.drawList[a][this.model+"_x"]),s.y=Number(this.drawList[a][this.model+"_y"]),this.master[this.drawList[a].id].setLastPoint(),this.master[this.drawList[a].id].setNextPoint(s)}G.push(this.animate.bind(this))}},{key:"animate",value:function(e){if(this.timeLeft+=e,this.timeLeft>=this.animationTime)G.pop();else for(var t=z.easeInOutCubic(this.timeLeft/this.animationTime),i=0;i<this.drawList.length;++i)this.master[this.drawList[i].id].moveToNextPoint(t)}}]),e}(),Y=function(e){function t(e){var i;return Object(k.a)(this,t),(i=Object(L.a)(this,Object(P.a)(t).call(this,e))).nextPoint=new q.Point,i.lastPoint=new q.Point,i}return Object(O.a)(t,e),Object(j.a)(t,[{key:"setNextPoint",value:function(e){this.nextPoint=e}},{key:"setLastPoint",value:function(){this.lastPoint=this.position}},{key:"moveToNextPoint",value:function(e){this.position.x=(1-e)*this.lastPoint.x+e*this.nextPoint.x,this.position.y=(1-e)*this.lastPoint.y+e*this.nextPoint.y}}]),t}(q.Sprite),J=U,K=i(18),Z=function(e){function t(e){var i;return Object(k.a)(this,t),(i=Object(L.a)(this,Object(P.a)(t).call(this,e))).state={data:null,play:!1,unique_IDS:{}},i.changeDate=i.changeDate.bind(Object(K.a)(i)),i}return Object(O.a)(t,e),Object(j.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e}},{key:"changeDate",value:function(e){e<0?e=this.state.dates.length-1:e>this.state.dates.length-1&&(e=0);var t=this.state.dates[e];this.setState({current_date:t,current_date_index:e,data_day:this.state.data[t]})}},{key:"changeModel",value:function(e){this.setState({model:e})}},{key:"componentDidMount",value:function(){var e=Object(x.a)(b.a.mark((function e(){var t,i,n,a,r,o,s,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([N.a("./data/list-daily-datasets.csv"),N.k("./data/regioni.geojson")]);case 2:return t=e.sent,i=t[0].map((function(e){return e.date})),n={},e.next=7,Promise.all(t[0].map((function(e){return N.a("./data/"+e.file_name)})));case 7:for(a=e.sent,r=0;r<i.length;r++){for(o=0;o<a[r].length;o++)(s=a[r][o]).x=Number(s.origin_x),s.y=Number(s.origin_y),s.id in this.state.unique_IDS||(this.state.unique_IDS[s.id]={category:s.category,position:{x:s.bunches_x,y:s.bunches_y}});n[i[r]]=a[r]}return i.length-1,0,c=n[i[0]],e.next=14,this.setState({data:n,dates:i,current_date:i[0],current_date_index:0,data_day:c,model:"bunches",mapGeometries:t[1]});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return f.a.createElement("div",{ref:this._setRef.bind(this)},this.state.data&&f.a.createElement(J,{data:this.state.data_day.reverse(),model:this.state.model,mapGeometries:this.state.mapGeometries,play:this.state.play,current_date_index:this.state.current_date_index,changeDate:this.changeDate,unique_IDS:this.state.unique_IDS}),f.a.createElement("header",{style:{position:"fixed",top:0}},f.a.createElement("p",null,f.a.createElement("input",{type:"button",name:"prev-date",value:"\u23ea",onClick:function(){return e.changeDate(e.state.current_date_index-1)}}),f.a.createElement("input",{type:"button",name:"prev-date",value:"\u25b6\ufe0f",onClick:function(){return e.setState({play:!e.state.play},e.changeDate(e.state.current_date_index+1))}}),f.a.createElement("input",{type:"button",name:"prev-date",value:"\u23e9",onClick:function(){return e.changeDate(e.state.current_date_index+1)}}),f.a.createElement("input",{type:"button",name:"bands",value:"\ud83d\uddbc",onClick:function(){return e.changeModel("stripes")}}),f.a.createElement("input",{type:"button",name:"bunch",value:"\ud83d\udc90",onClick:function(){return e.changeModel("bunches")}}),f.a.createElement("input",{type:"button",name:"clusters",value:"\ud83c\udfaf",onClick:function(){return e.changeModel("clusters")}}),this.state.current_date)))}}]),t}(p.Component),$=new(i(90).GPU),Q=window.devicePixelRatio||1,ee=function(e){function t(){return Object(k.a)(this,t),Object(L.a)(this,Object(P.a)(t).apply(this,arguments))}return Object(O.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=window.innerWidth/Q,t=window.innerHeight/Q;q.Ticker.shared.stop();var i=new q.Application({autoStart:!1,width:e,height:t,backgroundColor:16056305,resolution:Q,powerPreference:"high-performance",sharedTicker:!1});this._rootNode.appendChild(i.view);var n=new H.a({passiveWheel:!1,stopPropagation:!0,divWheel:this._rootNode,screenWidth:e,screenHeight:t,worldWidth:e,worldHeight:t,interaction:i.renderer.plugins.interaction});n.drag({pressDrag:!0,clampWheel:!0}).pinch().wheel(),i.stage.addChild(n);var a=new q.ParticleContainer(2e5,{vertices:!1,position:!0,rotation:!1,uvs:!1,tint:!1});n.addChild(a);var r=[];i.loader.add("sprites","./flowers-textures-1.png"),i.loader.onProgress.add((function(e){console.log(e.progress+"%")})),i.loader.onComplete.add(Object(x.a)(b.a.mark((function o(){var s,c,l,d,u,h,m,p,f,v,_,g,w;return b.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return console.log("loader completed"),s=i.loader.resources.sprites.texture.baseTexture,o.next=4,N.k("./flowers-textures-1.json");case 4:for(l in(c=o.sent).frames)d=c.frames[l].frame,u=new q.Texture(s,new q.Rectangle(d.x,d.y,d.w,d.h)),r.push(u);for(h=[],[],[],m=0;m<2e5;++m)p=new te(r[m%5]),f=e*Math.random(),v=t*Math.random(),_=-.5+Math.random(),g=-.5+Math.random(),p.x=f,p.y=v,p.speedX=_,p.speedY=g,w=[f,v,_,g],h.push(w),p.anchor.x=.5,p.anchor.y=.5,p.scale.x=.125,p.scale.y=.125,a.addChild(p);$.createKernel((function(e,t){var i=e[this.thread.x][2],n=e[this.thread.x][0]+i;n<0?(n=0,i*=-1):n>t[0]&&(n=t[0],i*=-1);var a=e[this.thread.x][3],r=e[this.thread.x][1]+a;return r<0?(r=0,a*=-1):r>t[1]&&(r=t[1],a*=-1),[n,r,i,a]})).setOutput([2e5]),0,function r(){0;for(var o=0;o<2e5;o++){var s=a.children[o];s.x+=s.speedX,s.x>e?(s.speedX*=-1,s.x=e):s.x<0&&(s.speedX*=-1,s.x=0),s.y+=s.speedY,s.y>t?(s.speedY*=-1,s.y=t):s.y<0&&(s.speedY*=-1,s.y=0)}i.renderer.render(n),requestAnimationFrame(r)}();case 14:case"end":return o.stop()}}),o)})))),i.loader.load()}},{key:"_setRef",value:function(e){this._rootNode=e}},{key:"render",value:function(){return f.a.createElement("div",{ref:this._setRef.bind(this)})}}]),t}(p.Component),te=function(e){function t(e){var i;return Object(k.a)(this,t),(i=Object(L.a)(this,Object(P.a)(t).call(this,e))).nextPoint=new q.Point,i.lastPoint=new q.Point,i}return Object(O.a)(t,e),Object(j.a)(t,[{key:"setNextPoint",value:function(e){this.nextPoint=e}},{key:"setLastPoint",value:function(){this.lastPoint=this.position}},{key:"moveToNextPoint",value:function(e){this.position.x=(1-e)*this.lastPoint.x+e*this.nextPoint,this.position.y=(1-e)*this.lastPoint.y+e*this.nextPoint}}]),t}(q.Sprite),ie=ee,ne=window.devicePixelRatio||1,ae=window.innerWidth,re=window.innerHeight,oe=N.i(),se=N.j(),ce=[],le=0,de=function(e){function t(e){var i;return Object(k.a)(this,t),(i=Object(L.a)(this,Object(P.a)(t).call(this,e))).state={model:"bunches",viewBuffer:null,day:"none",day_index:-1},i}return Object(O.a)(t,e),Object(j.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e}},{key:"componentDidMount",value:function(){var e=this,t={};(m=Object.keys(this.props.data)).forEach((function(i){for(var n=0;n<e.props.data[i].length;++n){var a=e.props.data[i][n];a.id in t||(t[a.id]={})}}));var i=Object.keys(t);c=new q.Application({width:ae,height:re,backgroundColor:16448250,autoDensity:!0,resolution:ne,powerPreference:"high-performance",antialias:!1,sharedTicker:!1,autoStart:!1}),q.Ticker.shared.stop(),this._rootNode.querySelector("#visualization").appendChild(c.view),(l=new H.a({passiveWheel:!1,stopPropagation:!0,divWheel:this._rootNode,screenWidth:ae,screenHeight:re,worldWidth:ae,worldHeight:re,interaction:c.renderer.plugins.interaction})).drag({pressDrag:!0,clampWheel:!0}).pinch().wheel(),c.stage.addChild(l),u=new q.Container,l.addChild(u);var n=this.props.topojson,a=E.a(n,n.objects.countries),r=a.features.find((function(t){return t.id===e.props.country_info.country_code}));oe.fitExtent([[5,5],[758,1014]],r),a.features.filter((function(t){return t.id===e.props.country_info.country_code})).forEach((function(e){var t=new q.Graphics;se.projection(oe).context(t),t.beginFill(14680022,1),t.lineStyle(1,16448250,.5),se(e),t.endFill(),u.addChild(t)})),d=new q.ParticleContainer(i.length,{vertices:!1,position:!0,rotation:!1,uvs:!1,tint:!1}),l.addChild(d),c.loader.add("flowersTextures","./flowers-textures-1.json"),c.loader.onComplete.add((function(){h=c.loader.resources.flowersTextures.textures;for(var t={},n=0;n<i.length;++n){var a=i[n],r=e.props.country_info.categories_codes[a.substring(2,3)]+".png",o=new he(h[r]);o.x=50,o.y=50,o.anchor.x=.5,o.anchor.y=.5,o.scale.x=.2,o.scale.y=.2,t[a]=o}var s=new ue(t,d);e.setState({day:m[0],day_index:0,viewBuffer:s}),le=Date.now();!function e(){var t=(Date.now()-le)/1e3;le=Date.now();for(var i=0;i<ce.length;++i)ce[i](t);c.renderer.render(l),requestAnimationFrame(e)}()})),c.loader.load()}},{key:"componentDidUpdate",value:function(e,t){console.log("did update"),t.day_index!==this.state.day_index?(console.log("day"),this.state.viewBuffer.clearObjects(),this.state.viewBuffer.setDrawList(this.props.data[m[this.state.day_index]],this.state.model),this.state.viewBuffer.drawObjects()):t.model!==this.state.model?(console.log("animation"),this.state.viewBuffer.model=this.state.model,this.state.viewBuffer.startAnimation(5,c)):console.log("none of above")}},{key:"changeDate",value:function(e){e<0?e=m.length-1:e>m.length-1&&(e=0);var t=m[e];this.setState({day:t,day_index:e})}},{key:"changeModel",value:function(e){this.setState({model:e})}},{key:"render",value:function(){var e=this;return f.a.createElement("div",{style:{width:"100vw",height:"100vh"},ref:this._setRef.bind(this)},f.a.createElement("div",{id:"visualization"}),f.a.createElement("div",{id:"controls",style:{position:"fixed",bottom:0}},f.a.createElement("p",null,f.a.createElement("input",{type:"button",name:"prev-date",value:"previous day",onClick:function(){return e.changeDate(e.state.day_index-1)}}),this.state.day&&f.a.createElement("span",null,this.state.day),f.a.createElement("input",{type:"button",name:"prev-date",value:"next day",onClick:function(){return e.changeDate(e.state.day_index+1)}}),f.a.createElement("input",{type:"button",name:"bands",value:"stripes",onClick:function(){return e.changeModel("stripes")}}),f.a.createElement("input",{type:"button",name:"bunch",value:"bunches",onClick:function(){return e.changeModel("bunches")}}),f.a.createElement("input",{type:"button",name:"clusters",value:"clusters",onClick:function(){return e.changeModel("clusters")}}))))}}]),t}(p.Component),ue=function(){function e(t,i){Object(k.a)(this,e),this.master={},this.drawList=[],this.animationTime=0,this.timeLeft=0,this.app=null,this.container=null,this.model=null,this.master=t,this.container=i}return Object(j.a)(e,[{key:"setDrawList",value:function(e,t){this.drawList=e,this.model=t}},{key:"clearObjects",value:function(){this.container.removeChildren()}},{key:"drawObjects",value:function(){if("stripes"!==this.model)for(var e=0;e<this.drawList.length;++e)this.master[this.drawList[e].id].position.x=Number(this.drawList[e][this.model+"_x"]),this.master[this.drawList[e].id].position.y=Number(this.drawList[e][this.model+"_y"]),this.container.addChild(this.master[this.drawList[e].id]);else for(var t=0;t<this.drawList.length;++t)this.master[this.drawList[t].id].position.x=Number(this.drawList[t][this.model+"_x"])*ae,this.master[this.drawList[t].id].position.y=Number(this.drawList[t][this.model+"_y"])*re,this.container.addChild(this.master[this.drawList[t].id])}},{key:"startAnimation",value:function(e,t){if(console.log("animation"),this.animationTime=e,this.timeLeft=0,this.app=t,"stripes"===this.model)for(var i=0;i<this.drawList.length;++i){var n=new q.Point;n.x=Number(this.drawList[i][this.model+"_x"])*ae,n.y=Number(this.drawList[i][this.model+"_y"])*re,this.master[this.drawList[i].id].setLastPoint(),this.master[this.drawList[i].id].setNextPoint(n)}else for(var a=0;a<this.drawList.length;++a){var r=new q.Point;r.x=Number(this.drawList[a][this.model+"_x"]),r.y=Number(this.drawList[a][this.model+"_y"]),this.master[this.drawList[a].id].setLastPoint(),this.master[this.drawList[a].id].setNextPoint(r)}ce.push(this.animate.bind(this))}},{key:"animate",value:function(e){if(this.timeLeft+=e,this.timeLeft>=this.animationTime)ce.pop();else for(var t=z.easeInOutCubic(this.timeLeft/this.animationTime),i=0;i<this.drawList.length;++i)this.master[this.drawList[i].id].moveToNextPoint(t)}}]),e}(),he=function(e){function t(e){var i;return Object(k.a)(this,t),(i=Object(L.a)(this,Object(P.a)(t).call(this,e))).nextPoint=new q.Point,i.lastPoint=new q.Point,i}return Object(O.a)(t,e),Object(j.a)(t,[{key:"setNextPoint",value:function(e){this.nextPoint=e}},{key:"setLastPoint",value:function(){this.lastPoint=this.position}},{key:"moveToNextPoint",value:function(e){this.position.x=(1-e)*this.lastPoint.x+e*this.nextPoint.x,this.position.y=(1-e)*this.lastPoint.y+e*this.nextPoint.y}}]),t}(q.Sprite),me=de,pe=function(e){function t(e){var i;return Object(k.a)(this,t),(i=Object(L.a)(this,Object(P.a)(t).call(this,e))).state={},i}return Object(O.a)(t,e),Object(j.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e}},{key:"componentDidMount",value:function(){var e=Object(x.a)(b.a.mark((function e(){var t,i,n,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([N.a("./data/italy/datasets.csv"),N.k("./data/world-50m.json")]);case 2:return t=e.sent,e.next=5,Promise.all(t[0].map((function(e){return N.a("./data/italy/"+e.file_name)})));case 5:i=e.sent,n={},t[0].map((function(e){return e.date})).forEach((function(e,t){n[e]=i[t]})),a=t[1],this.setState({data:n,topojson:a});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return f.a.createElement("div",{className:"italy",ref:this._setRef.bind(this)},!this.state.data&&f.a.createElement("div",null,"Loading data..."),this.state.data&&f.a.createElement(me,{data:this.state.data,topojson:this.state.topojson,country_info:fe}))}}]),t}(p.Component),fe={country_code:"380",regions_codes:{13:"Abruzzo",17:"Basilicata",18:"Calabria",15:"Campania","08":"Emilia-Romagna","06":"Friuli Venezia Giulia",12:"Lazio","07":"Liguria","03":"Lombardia",11:"Marche",14:"Molise","01":"Piemonte",16:"Puglia",20:"Sardegna",19:"Sicilia","09":"Toscana","04":"Trentino-Alto Adige",10:"Umbria","02":"Valle d'Aosta","05":"Veneto"},categories_codes:{1:"deceased",2:"intensive_cares",3:"hospitalized",4:"home_isolation",5:"recovered"}};var ve=function(){return f.a.createElement("div",{className:"App"},f.a.createElement(g.a,{basename:"/"},f.a.createElement(w.a,{exact:!0,path:"/"},f.a.createElement("nav",null,f.a.createElement("ul",null,f.a.createElement("li",null,f.a.createElement(g.b,{to:"/performances"},"Testing PIXIjs performances")),f.a.createElement("li",null,f.a.createElement(g.b,{to:"/viz"},"Visualization")),f.a.createElement("li",null,f.a.createElement(g.b,{to:"/italy"},"Italy"))))),f.a.createElement(w.a,{path:"/svg"},f.a.createElement(I,null)),f.a.createElement(w.a,{path:"/pixi"},f.a.createElement(J,null)),f.a.createElement(w.a,{path:"/viz"},f.a.createElement(Z,null)),f.a.createElement(w.a,{path:"/performances"},f.a.createElement(ie,null)),f.a.createElement(w.a,{path:"/italy"},f.a.createElement(pe,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));_.a.render(f.a.createElement(ve,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[124,1,2]]]);
//# sourceMappingURL=main.aa616459.chunk.js.map