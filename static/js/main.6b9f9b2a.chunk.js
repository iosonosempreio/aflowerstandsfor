(this["webpackJsonpcovi-z"]=this["webpackJsonpcovi-z"]||[]).push([[0],{102:function(e,t,a){"use strict";a.r(t);var n,r,o=a(0),i=a.n(o),s=a(55),c=a.n(s),l=(a(85),a(28)),d=a(16),u=(a(86),a(4)),p=a(5),h=a(7),m=a(3),f=a(6),g=a(2),v=a(56),y=a.n(v),_={emoji:{size:20},clampZoomOptions:{minScale:.01,maxScale:7},emoji_dictionary:{dimessi_guariti:"\ud83c\udf40",isolamento_domiciliare:"\u26aa\ufe0f",ricoverati_con_sintomi:"\ud83c\udf3c",terapia_intensiva:"\ud83c\udf38",deceduti:"\ud83c\udf3a"},emoji_images_dictionary:{dimessi_guariti:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/four-leaf-clover_1f340.png",isolamento_domiciliare:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/blossom_1f33c.png",ricoverati_con_sintomi:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/sunflower_1f33b.png",terapia_intensiva:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/cherry-blossom_1f338.png",deceduti:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/hibiscus_1f33a.png"},categories:["deceduti","terapia_intensiva","ricoverati_con_sintomi","isolamento_domiciliare","dimessi_guariti"],categories_en:["deceased","intensive_care","hospitalized","home_isolation","recovered"],category2english:{deceduti:"deceased",terapia_intensiva:"intensive_care",ricoverati_con_sintomi:"hospitalized",isolamento_domiciliare:"home_isolation",dimessi_guariti:"recovered"},map:{width:768,height:1024,scale:3e4},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}},x=_,w=g.f().stop(),b=x.emoji.size/x.clampZoomOptions.maxScale,k=[],j=JSON.parse(JSON.stringify(x.categories)),O=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).state={data:[]},a}return Object(f.a)(t,e),Object(p.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e,r=g.i().fitSize([x.map.width-50,x.map.height-50],this._rootNode).translate([x.map.width/2,x.map.height/2]).scale(x.map.scale).center([12.368775000000001,42.9451139])}},{key:"componentDidMount",value:function(){var e=this;g.a("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv").then((function(t){var a=g.m().key((function(e){return e.data})).entries(t);console.log(a);var o={};a.forEach((function(e){var t=e.key,a=e.values;a.forEach((function(e){var t=r([e.long,e.lat]);e.x=t[0],e.y=t[1]})),o[t]=[],a.forEach((function(e,a){x.categories.forEach((function(a){for(var n=0;n<e[a];++n){var r={id:e.denominazione_regione+"-"+a+"-"+n+1,category:a,denominazione_regione:e.denominazione_regione,date:e.data,_x:e.x,_y:e.y,x:e.x,y:e.y};o[t].push(r)}}))}))})),e.setState({data:o},(function(){var t=g.o(e._rootNode),a=t.append("g");var r=g.p().extent([[0,0],[window.innerWidth,window.innerHeight]]).scaleExtent([x.clampZoomOptions.minScale,2*x.clampZoomOptions.maxScale]).on("zoom",(function(){a.attr("transform",g.c.transform)}));t.call(r),t.call(r.transform,g.q.translate(-5,-340).scale(5)),n=a.selectAll("text"),w.nodes(k).tick(1e3).on("tick",(function(){document.title=w.alpha(),n.attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y}))})).force("x",g.g((function(e){return e._x}))).force("y",g.h((function(e){return e._y}))).force("charge",g.e().strength(-.05)).alphaDecay(.1).alphaMin(.1);var o=Object.keys(e.state.data);o=o.slice(0,5);!function t(){var a=o.shift();console.log(a);var n=e.state.data[a];console.log(n),j=JSON.parse(JSON.stringify(x.categories)),k=E(k,n,j.shift()),C(),w.force("collision",null),w.on("end",(function(){document.title="simulation ended",j.length>0?(k=E(k,n,j.shift()),C()):(document.title="running anticollision",console.log("running anticollision"),w.force("collision",g.d(x.emoji.size/x.clampZoomOptions.maxScale/2*.9).strength(.1)),w.alpha(1).restart().on("end",(function(){console.log("done anticollision, missing",o.length),o.length>0?(k.forEach((function(e){delete e.x,delete e.y,delete e.index,delete e.vx,delete e.vy,delete e.fx,delete e.fy})),k=[],t()):N(e.state.data)})))}))}()}))})),document.addEventListener("keypress",(function(e){"r"===e.key?w.alpha(1).restart():"\\"===e.key?w.alpha(1e-5).restart():"c"===e.key||99===e.keyCode?(k.forEach((function(e){e.fx=null,e.fy=null})),w.force("collision",g.d(x.emoji.size/x.clampZoomOptions.maxScale/2*.9).strength(.1)),w.alpha(1).restart()):"d"===e.key&&N(k)}))}},{key:"render",value:function(){return i.a.createElement("svg",{ref:this._setRef.bind(this),style:{width:"100%",height:"100%"}})}}]),t}(o.Component),E=function(e,t,a){e.forEach((function(e){e.fx=e.x,e.fy=e.y}));var n=t.filter((function(e){return e.category===a})),r=360/n.length*20,o=2*Math.sqrt((n.length+e.length)/Math.PI);return n.forEach((function(e,t){e.x=e._x+Math.cos(Math.PI/180*t*r)*(o+t/80)+g.n(-5,5)(),e.y=e._y+Math.sin(Math.PI/180*t*r)*(o+t/80)+g.n(-5,5)()})),e.concat(n)},C=function(){(n=n.data(k,(function(e){return e.id}))).exit().remove(),n=n.enter().append("text").classed("node",!0).attr("font-size",b+"px").text((function(e){return x.emoji_dictionary[e.category]})).attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y})).call(g.b().on("start",S).on("drag",z).on("end",M)).merge(n),w.nodes(k).alpha(1).restart()};function S(e){g.c.active||w.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function z(e){e.fx=g.c.x,e.fy=g.c.y}function M(e){g.c.active||w.alphaTarget(0),e.fx=null,e.fy=null}function N(e){var t=new Blob([JSON.stringify(e)],{type:"application/json;charset=utf-8"});y.a.saveAs(t,"covi-z-storico.json")}var D,P,R,W,I,T,Z=a(14),A=a.n(Z),J=a(20),G=a(60),H=a(11),B=a(1),X=a(27),q={},F={},Y=window.devicePixelRatio||1,L=g.j().translate([x.map.width/2,x.map.height/2]).scale(x.map.scale).center([12.368775000000001,42.9451139]),V=g.f().force("x",g.g().strength(.15)).force("y",g.h().strength(.15)).alphaMin(.03).stop(),U=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).updateSprites=a.updateSprites.bind(Object(H.a)(a)),a.repositionSprites=a.repositionSprites.bind(Object(H.a)(a)),a}return Object(f.a)(t,e),Object(p.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e}},{key:"updateSprites",value:function(){for(var e=Object(G.a)({},F),t=0;t<this.props.data.length;++t){var a=this.props.data[t];delete a.date;var n=a.id;if(F[n]){var r=F[n]._data_.x,o=F[n]._data_.y;a.x=r,a.y=o,F[n]._data_=a}else{var i=B.Sprite.from(q[a.category]);i.anchor.set(.5),i.scale.x=1/7,i.scale.y=1/7,i._data_=a,F[this.props.data[t].id]=i,R.addChild(i)}delete e[n]}for(var s in e)delete F[s],R.removeChild(e[s]);this.props.data.length!==R.children.length&&console.warn("Problem in sprites update:\ntotal data:",this.props.data.length,"total sprites:",R.children.length),this.repositionSprites()}},{key:"repositionSprites",value:function(){var e=this,t=!0;V.nodes(this.props.data),"stripes"===this.props.model?(V.force("x").x((function(t){return 15+t["".concat(e.props.model,"_x")]*(I-30)})),V.force("y").y((function(t){return 15+t["".concat(e.props.model,"_y")]*(T-30)})),P.snap(0,0,{topLeft:!0,interrupt:!0,removeOnComplete:!0,removeOnInterrupt:!0}),P.snapZoom({center:new B.Point(I/2,T/2),width:I,interrupt:!0,removeOnComplete:!0,removeOnInterrupt:!0}),W.renderable=!1):(V.force("x").x((function(t){return+t["".concat(e.props.model,"_x")]})),V.force("y").y((function(t){return+t["".concat(e.props.model,"_y")]})),W.renderable=!0),V.on("end",(function(){console.log("simulation ended for",e.props.model),t=!1})),V.on("end",(function(){e.props.play&&e.props.changeDate(e.props.current_date_index+1)})),V.alpha(1),V.restart(),function e(){for(var a=0;a<R.children.length;a++)R.children[a].x=R.children[a]._data_.x,R.children[a].y=R.children[a]._data_.y;(t||V.alpha()>.05)&&requestAnimationFrame(e)}()}},{key:"componentDidMount",value:function(){var e=this;I=this._rootNode.getBoundingClientRect().width,T=this._rootNode.getBoundingClientRect().height,D=new B.Application({width:I,height:T,backgroundColor:16056305,resolution:Y,autoResize:!0}),this._rootNode.appendChild(D.view),(P=new X.a({center:new B.Point(-I/2,-T/2),passiveWheel:!1,stopPropagation:!0,divWheel:this._rootNode,screenWidth:I,screenHeight:T,worldWidth:I,worldHeight:T,interaction:D.renderer.plugins.interaction})).clampZoom(x.clampZoomOptions).drag({pressDrag:!0,clampWheel:!0}).pinch().wheel(),D.stage.addChild(P),(W=new B.Container).renderable=!1,P.addChild(W);for(var t=0;t<this.props.mapGeometries.features.length;t++){var a=this.props.mapGeometries.features[t],n=new B.Graphics,r=g.k().projection(L).context(n);n.beginFill(16777215,1),n.lineStyle(1,3355443,.5),r(a),n.endFill(),W.addChild(n)}R=new B.ParticleContainer(1e5),P.addChild(R),D.loader.add("sprites","./flowers-textures-1.png"),D.loader.onProgress.add((function(e){console.log(e.progress+"%")})),D.loader.onComplete.add(Object(J.a)(A.a.mark((function t(){var a,n,r,o,i;return A.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=D.loader.resources.sprites.texture.baseTexture,t.next=3,g.l("./flowers-textures-1.json");case 3:for(r in(n=t.sent).frames)o=n.frames[r].frame,i=new B.Texture(a,new B.Rectangle(o.x,o.y,o.w,o.h)),q[r.replace(".png","")]=i;e.updateSprites();case 6:case"end":return t.stop()}}),t)})))),D.loader.load()}},{key:"componentDidUpdate",value:function(e){V.stop(),e.data!==this.props.data?this.updateSprites():e.model!==this.props.model&&this.repositionSprites()}},{key:"render",value:function(){return i.a.createElement("div",{style:{width:"100vw",height:"calc(100vh - 144px)"},ref:this._setRef.bind(this)})}}]),t}(o.Component),$=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).state={data:null,play:!1},a.changeDate=a.changeDate.bind(Object(H.a)(a)),a}return Object(f.a)(t,e),Object(p.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e}},{key:"changeDate",value:function(e){e<0?e=this.state.dates.length-1:e>this.state.dates.length-1&&(e=0);var t=this.state.dates[e];this.setState({current_date:t,current_date_index:e,data_day:this.state.data[t]})}},{key:"changeModel",value:function(e){this.setState({model:e})}},{key:"componentDidMount",value:function(){var e=Object(J.a)(A.a.mark((function e(){var t,a,n,r,o,i,s,c;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([g.a("./data/list-daily-datasets.csv"),g.l("./data/regioni.geojson")]);case 2:return t=e.sent,a=t[0].map((function(e){return e.date})),n={},e.next=7,Promise.all(t[0].map((function(e){return g.a("./data/"+e.file_name)})));case 7:for(r=e.sent,o=0;o<a.length;o++){for(i=0;i<r[o].length;i++)(s=r[o][i]).x=Number(s.origin_x),s.y=Number(s.origin_y);n[a[o]]=r[o]}return a.length-1,0,c=n[a[0]],e.next=14,this.setState({data:n,dates:a,current_date:a[0],current_date_index:0,data_day:c,model:"bunches",mapGeometries:t[1]});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return i.a.createElement("div",{ref:this._setRef.bind(this)},i.a.createElement("header",null,"header",i.a.createElement("p",null,i.a.createElement("input",{type:"button",name:"prev-date",value:"\u23ea",onClick:function(){return e.changeDate(e.state.current_date_index-1)}}),i.a.createElement("input",{type:"button",name:"prev-date",value:"\u25b6\ufe0f",onClick:function(){return e.setState({play:!e.state.play},e.changeDate(e.state.current_date_index+1))}}),i.a.createElement("input",{type:"button",name:"prev-date",value:"\u23e9",onClick:function(){return e.changeDate(e.state.current_date_index+1)}}),i.a.createElement("input",{type:"button",name:"bands",value:"\ud83d\uddbc",onClick:function(){return e.changeModel("stripes")}}),i.a.createElement("input",{type:"button",name:"bunch",value:"\ud83d\udc90",onClick:function(){return e.changeModel("bunches")}}),i.a.createElement("input",{type:"button",name:"clusters",value:"\ud83c\udfaf",onClick:function(){return e.changeModel("clusters")}}),this.state.current_date)),this.state.data&&i.a.createElement(U,{data:this.state.data_day.reverse(),model:this.state.model,mapGeometries:this.state.mapGeometries,play:this.state.play,current_date_index:this.state.current_date_index,changeDate:this.changeDate}),i.a.createElement("footer",null,"footer"))}}]),t}(o.Component),K=window.devicePixelRatio||1,Q=function(e){function t(){return Object(u.a)(this,t),Object(h.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=window.innerWidth/K,t=window.innerHeight/K;B.Ticker.shared.stop();var a=new B.Application({autoStart:!1,width:e,height:t,backgroundColor:16056305,resolution:K,powerPreference:"high-performance",sharedTicker:!1});this._rootNode.appendChild(a.view);var n=new X.a({passiveWheel:!1,stopPropagation:!0,divWheel:this._rootNode,screenWidth:e,screenHeight:t,worldWidth:e,worldHeight:t,interaction:a.renderer.plugins.interaction});n.drag({pressDrag:!0,clampWheel:!0}).pinch().wheel(),a.stage.addChild(n);var r=new B.ParticleContainer(2e5,{vertices:!1,position:!0,rotation:!1,uvs:!1,tint:!1});n.addChild(r);var o=[];a.loader.add("sprites","./flowers-textures-1.png"),a.loader.onProgress.add((function(e){console.log(e.progress+"%")})),a.loader.onComplete.add(Object(J.a)(A.a.mark((function i(){var s,c,l,d,u,p,h,m,f;return A.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return console.log("loader completed"),s=a.loader.resources.sprites.texture.baseTexture,i.next=4,g.l("./flowers-textures-1.json");case 4:for(l in(c=i.sent).frames)d=c.frames[l].frame,u=new B.Texture(s,new B.Rectangle(d.x,d.y,d.w,d.h)),o.push(u);for(p=0;p<2e5;++p)h=p%5,(m=new B.Sprite(o[h])).speedX=-.5+Math.random(),m.speedY=-.5+Math.random(),m.anchor.x=.5,m.x=e*Math.random(),m.y=t*Math.random(),m.scale.x=.125,m.scale.y=.125,r.addChild(m);f=0,function o(){if(f<1e3){f++;for(var i=0;i<2e5;i++){var s=r.children[i];s.x+=s.speedX,s.y+=s.speedY,s.x>e?(s.speedX*=-1,s.x=e):s.x<0&&(s.speedX*=-1,s.x=0),s.y>t?(s.speedY*=-1,s.y=t):s.y<0&&(s.speedY*=-1,s.y=0)}}a.renderer.render(n),requestAnimationFrame(o)}();case 10:case"end":return i.stop()}}),i)})))),a.loader.load()}},{key:"_setRef",value:function(e){this._rootNode=e}},{key:"render",value:function(){return i.a.createElement("div",{ref:this._setRef.bind(this)})}}]),t}(o.Component);var ee=function(){return i.a.createElement("div",{className:"App"},i.a.createElement(l.a,{basename:"/"},i.a.createElement(d.a,{exact:!0,path:"/"},i.a.createElement("nav",null,i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement(l.b,{to:"/performances"},"Testing PIXIjs performances")),i.a.createElement("li",null,i.a.createElement(l.b,{to:"/viz"},"Visualization"))))),i.a.createElement(d.a,{path:"/svg"},i.a.createElement(O,null)),i.a.createElement(d.a,{path:"/pixi"},i.a.createElement(U,null)),i.a.createElement(d.a,{path:"/viz"},i.a.createElement($,null)),i.a.createElement(d.a,{path:"/performances"},i.a.createElement(Q,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(i.a.createElement(ee,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},80:function(e,t,a){e.exports=a(102)},85:function(e,t,a){},86:function(e,t,a){}},[[80,1,2]]]);
//# sourceMappingURL=main.6b9f9b2a.chunk.js.map