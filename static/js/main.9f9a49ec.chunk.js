(this["webpackJsonpcovi-z"]=this["webpackJsonpcovi-z"]||[]).push([[0],{102:function(e,t,n){"use strict";n.r(t);var a,i,o=n(0),r=n.n(o),s=n(53),c=n.n(s),l=(n(85),n(20)),u=n(15),d=(n(86),n(4)),p=n(5),h=n(6),m=n(3),f=n(7),g=n(1),v=n(54),y=n.n(v),_={emoji:{size:20},clampZoomOptions:{minScale:.01,maxScale:7},emoji_dictionary:{dimessi_guariti:"\ud83c\udf40",isolamento_domiciliare:"\u26aa\ufe0f",ricoverati_con_sintomi:"\ud83c\udf3c",terapia_intensiva:"\ud83c\udf38",deceduti:"\ud83c\udf3a"},emoji_images_dictionary:{dimessi_guariti:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/four-leaf-clover_1f340.png",isolamento_domiciliare:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/blossom_1f33c.png",ricoverati_con_sintomi:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/sunflower_1f33b.png",terapia_intensiva:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/cherry-blossom_1f338.png",deceduti:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/hibiscus_1f33a.png"},categories:["deceduti","terapia_intensiva","ricoverati_con_sintomi","isolamento_domiciliare","dimessi_guariti"],map:{width:768,height:1024,scale:3e4}},x=_,b=g.f().stop(),w=x.emoji.size/x.clampZoomOptions.maxScale,k=[],E=JSON.parse(JSON.stringify(x.categories)),j=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(h.a)(this,Object(m.a)(t).call(this,e))).state={data:[]},n}return Object(f.a)(t,e),Object(p.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e,i=g.i().fitSize([x.map.width-50,x.map.height-50],this._rootNode).translate([x.map.width/2,x.map.height/2]).scale(x.map.scale).center([12.368775000000001,42.9451139])}},{key:"componentDidMount",value:function(){var e=this;g.a("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv").then((function(t){var n=g.m().key((function(e){return e.data})).entries(t);console.log(n);var o={};n.forEach((function(e){var t=e.key,n=e.values;n.forEach((function(e){var t=i([e.long,e.lat]);e.x=t[0],e.y=t[1]})),o[t]=[],n.forEach((function(e,n){x.categories.forEach((function(n){for(var a=0;a<e[n];++a){var i={id:e.denominazione_regione+"-"+n+"-"+a+1,category:n,denominazione_regione:e.denominazione_regione,date:e.data,_x:e.x,_y:e.y,x:e.x,y:e.y};o[t].push(i)}}))}))})),e.setState({data:o},(function(){var t=g.o(e._rootNode),n=t.append("g");var i=g.p().extent([[0,0],[window.innerWidth,window.innerHeight]]).scaleExtent([x.clampZoomOptions.minScale,2*x.clampZoomOptions.maxScale]).on("zoom",(function(){n.attr("transform",g.c.transform)}));t.call(i),t.call(i.transform,g.q.translate(-5,-340).scale(5)),a=n.selectAll("text"),b.nodes(k).tick(1e3).on("tick",(function(){document.title=b.alpha(),a.attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y}))})).force("x",g.g((function(e){return e._x}))).force("y",g.h((function(e){return e._y}))).force("charge",g.e().strength(-.05)).alphaDecay(.1).alphaMin(.1);var o=Object.keys(e.state.data);o=o.slice(0,5);!function t(){var n=o.shift();console.log(n);var a=e.state.data[n];console.log(a),E=JSON.parse(JSON.stringify(x.categories)),k=O(k,a,E.shift()),S(),b.force("collision",null),b.on("end",(function(){document.title="simulation ended",E.length>0?(k=O(k,a,E.shift()),S()):(document.title="running anticollision",console.log("running anticollision"),b.force("collision",g.d(x.emoji.size/x.clampZoomOptions.maxScale/2*.9).strength(.1)),b.alpha(1).restart().on("end",(function(){console.log("done anticollision, missing",o.length),o.length>0?(k.forEach((function(e){delete e.x,delete e.y,delete e.index,delete e.vx,delete e.vy,delete e.fx,delete e.fy})),k=[],t()):D(e.state.data)})))}))}()}))})),document.addEventListener("keypress",(function(e){"r"===e.key?b.alpha(1).restart():"\\"===e.key?b.alpha(1e-5).restart():"c"===e.key||99===e.keyCode?(k.forEach((function(e){e.fx=null,e.fy=null})),b.force("collision",g.d(x.emoji.size/x.clampZoomOptions.maxScale/2*.9).strength(.1)),b.alpha(1).restart()):"d"===e.key&&D(k)}))}},{key:"render",value:function(){return r.a.createElement("svg",{ref:this._setRef.bind(this),style:{width:"100%",height:"100%"}})}}]),t}(o.Component),O=function(e,t,n){e.forEach((function(e){e.fx=e.x,e.fy=e.y}));var a=t.filter((function(e){return e.category===n})),i=360/a.length*20,o=2*Math.sqrt((a.length+e.length)/Math.PI);return a.forEach((function(e,t){e.x=e._x+Math.cos(Math.PI/180*t*i)*(o+t/80)+g.n(-5,5)(),e.y=e._y+Math.sin(Math.PI/180*t*i)*(o+t/80)+g.n(-5,5)()})),e.concat(a)},S=function(){(a=a.data(k,(function(e){return e.id}))).exit().remove(),a=a.enter().append("text").classed("node",!0).attr("font-size",w+"px").text((function(e){return x.emoji_dictionary[e.category]})).attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y})).call(g.b().on("start",C).on("drag",z).on("end",N)).merge(a),b.nodes(k).alpha(1).restart()};function C(e){g.c.active||b.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function z(e){e.fx=g.c.x,e.fy=g.c.y}function N(e){g.c.active||b.alphaTarget(0),e.fx=null,e.fy=null}function D(e){var t=new Blob([JSON.stringify(e)],{type:"application/json;charset=utf-8"});y.a.saveAs(t,"covi-z-storico.json")}var M,P,R,I,Z,W,G=n(60),J=n(11),A=n(2),B=n(56),V={},q={},F=window.devicePixelRatio||1,H=g.j().translate([x.map.width/2,x.map.height/2]).scale(x.map.scale).center([12.368775000000001,42.9451139]),T=g.f().force("x",g.g()).force("y",g.h()).alphaMin(.01).stop(),L=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(h.a)(this,Object(m.a)(t).call(this,e))).updateSprites=n.updateSprites.bind(Object(J.a)(n)),n.repositionSprites=n.repositionSprites.bind(Object(J.a)(n)),n}return Object(f.a)(t,e),Object(p.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e}},{key:"updateSprites",value:function(){for(var e=this,t=Object(G.a)({},q),n=function(n){var a=e.props.data[n];delete a.date;var i=a.id;if(q[i]){var o=q[i]._data_.x,r=q[i]._data_.y;a.x=o,a.y=r,q[i]._data_=a}else{var s=A.Sprite.from(V[a.category]);s.anchor.set(.5),s.scale.x=1/7,s.scale.y=1/7,s._data_=a,s.interactive=!0,s.buttonMode=!0,s.on("click",(function(){return console.log(a)})),q[e.props.data[n].id]=s,R.addChild(s)}delete t[i]},a=0;a<this.props.data.length;++a)n(a);for(var i in t)delete q[i],R.removeChild(t[i]);this.props.data.length!==R.children.length&&console.warn("Problem in sprites update:\ntotal data:",this.props.data.length,"total sprites:",R.children.length),this.repositionSprites()}},{key:"repositionSprites",value:function(){var e=this,t=!0;T.nodes(this.props.data),"stripes"===this.props.model?(T.force("x").x((function(t){return 15+t["".concat(e.props.model,"_x")]*(Z-30)})),T.force("y").y((function(t){return 15+t["".concat(e.props.model,"_y")]*(W-30)})),P.snap(0,0,{topLeft:!0,interrupt:!0,removeOnComplete:!0,removeOnInterrupt:!0}),P.snapZoom({center:new A.Point(Z/2,W/2),width:Z,interrupt:!0,removeOnComplete:!0,removeOnInterrupt:!0}),I.renderable=!1):(T.force("x").x((function(t){return+t["".concat(e.props.model,"_x")]})),T.force("y").y((function(t){return+t["".concat(e.props.model,"_y")]})),I.renderable=!0),T.on("end",(function(){console.log("simulation ended for",e.props.model),t=!1})),T.on("end",(function(){e.props.play&&e.props.changeDate(e.props.current_date_index+1)})),T.alpha(1),T.restart(),function e(){for(var n=0;n<R.children.length;n++)R.children[n].x=R.children[n]._data_.x,R.children[n].y=R.children[n]._data_.y;(t||T.alpha()>.05)&&requestAnimationFrame(e)}()}},{key:"componentDidMount",value:function(){Z=this._rootNode.getBoundingClientRect().width,W=this._rootNode.getBoundingClientRect().height,M=new A.Application({width:Z,height:W,backgroundColor:16056305,resolution:F,autoResize:!0}),this._rootNode.appendChild(M.view),(P=new B.a({center:new A.Point(-Z/2,-W/2),passiveWheel:!1,stopPropagation:!0,divWheel:this._rootNode,screenWidth:Z,screenHeight:W,worldWidth:Z,worldHeight:W,interaction:M.renderer.plugins.interaction})).clampZoom(x.clampZoomOptions).drag({pressDrag:!0,clampWheel:!0}).pinch().wheel(),M.stage.addChild(P),(I=new A.Container).renderable=!1,P.addChild(I);for(var e=0;e<this.props.mapGeometries.features.length;e++){var t=this.props.mapGeometries.features[e],n=new A.Graphics,a=g.k().projection(H).context(n);n.beginFill(16777215,1),n.lineStyle(1,3355443),a(t),n.endFill(),I.addChild(n)}R=new A.Container,P.addChild(R),x.categories.forEach((function(e){var t=A.Texture.from("./".concat(e,"_40x40.png"));V[e]=t})),this.updateSprites()}},{key:"componentDidUpdate",value:function(e){T.stop(),e.data!==this.props.data?this.updateSprites():e.model!==this.props.model&&this.repositionSprites()}},{key:"render",value:function(){return r.a.createElement("div",{style:{width:"100vw",height:"calc(100vh - 144px)"},ref:this._setRef.bind(this)})}}]),t}(o.Component),U=n(31),X=n.n(U),$=n(57),K=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(h.a)(this,Object(m.a)(t).call(this,e))).state={data:null,play:!1},n.changeDate=n.changeDate.bind(Object(J.a)(n)),n}return Object(f.a)(t,e),Object(p.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e}},{key:"changeDate",value:function(e){e<0?e=this.state.dates.length-1:e>this.state.dates.length-1&&(e=0);var t=this.state.dates[e];this.setState({current_date:t,current_date_index:e,data_day:this.state.data[t]})}},{key:"changeModel",value:function(e){this.setState({model:e})}},{key:"componentDidMount",value:function(){var e=Object($.a)(X.a.mark((function e(){var t,n,a,i,o,r,s,c,l;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([g.a("./data/list-daily-datasets.csv"),g.l("./data/regioni.geojson")]);case 2:return t=e.sent,n=t[0].map((function(e){return e.date})),a={},e.next=7,Promise.all(t[0].map((function(e){return g.a("./data/"+e.file_name)})));case 7:for(i=e.sent,o=0;o<n.length;o++){for(r=0;r<i[o].length;r++)(s=i[o][r]).x=Number(s.origin_x),s.y=Number(s.origin_y);a[n[o]]=i[o]}return c=n.length-1,l=a[n[c]],e.next=13,this.setState({data:a,dates:n,current_date:n[c],current_date_index:c,data_day:l,model:"stripes",mapGeometries:t[1]});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",{ref:this._setRef.bind(this)},r.a.createElement("p",null,r.a.createElement("input",{type:"button",name:"prev-date",value:"\u23ea",onClick:function(){return e.changeDate(e.state.current_date_index-1)}}),r.a.createElement("input",{type:"button",name:"prev-date",value:"\u25b6\ufe0f",onClick:function(){return e.setState({play:!e.state.play},e.changeDate(e.state.current_date_index+1))}}),r.a.createElement("input",{type:"button",name:"prev-date",value:"\u23e9",onClick:function(){return e.changeDate(e.state.current_date_index+1)}}),r.a.createElement("input",{type:"button",name:"bands",value:"\ud83d\uddbc",onClick:function(){return e.changeModel("stripes")}}),r.a.createElement("input",{type:"button",name:"bunch",value:"\ud83d\udc90",onClick:function(){return e.changeModel("bunches")}}),r.a.createElement("input",{type:"button",name:"clusters",value:"\ud83c\udfaf",onClick:function(){return e.changeModel("clusters")}}),this.state.current_date),this.state.data&&r.a.createElement(L,{data:this.state.data_day.reverse(),model:this.state.model,mapGeometries:this.state.mapGeometries,play:this.state.play,current_date_index:this.state.current_date_index,changeDate:this.changeDate}))}}]),t}(o.Component);var Q=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(l.a,{basename:"/"},r.a.createElement(u.a,{exact:!0,path:"/"},r.a.createElement("nav",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l.b,{to:"/svg"},"SVG Version")),r.a.createElement("li",null,r.a.createElement(l.b,{to:"/pixi"},"PIXIjs version")),r.a.createElement("li",null,r.a.createElement(l.b,{to:"/viz"},"Visualization"))))),r.a.createElement(u.a,{path:"/svg"},r.a.createElement(j,null)),r.a.createElement(u.a,{path:"/pixi"},r.a.createElement(L,null)),r.a.createElement(u.a,{path:"/viz"},r.a.createElement(K,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(Q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},80:function(e,t,n){e.exports=n(102)},85:function(e,t,n){},86:function(e,t,n){}},[[80,1,2]]]);
//# sourceMappingURL=main.9f9a49ec.chunk.js.map