(this["webpackJsonpcovi-z"]=this["webpackJsonpcovi-z"]||[]).push([[0],{104:function(e,t,n){"use strict";n.r(t);var i,a,o,r,c,l=n(0),s=n.n(l),d=n(55),u=n.n(d),m=(n(87),n(25)),h=n(14),p=(n(88),n(31)),f=n.n(p),g=n(56),v=n(3),w=n(4),y=n(7),_=n(2),x=n(8),j=n(6),b=n(57),O=n.n(b),z={emoji:{size:20},clampZoomOptions:{minScale:.5,maxScale:10},emoji_dictionary:{dimessi_guariti:"\ud83c\udf40",isolamento_domiciliare:"\ud83d\udcae",ricoverati_con_sintomi:"\ud83c\udf3c",terapia_intensiva:"\ud83c\udf38",deceduti:"\ud83c\udf3a"},categories:["ricoverati_con_sintomi","terapia_intensiva","isolamento_domiciliare","dimessi_guariti","deceduti"],map:{width:768,height:1024}},k=z,E=j.d().stop(),S=k.emoji.size/k.clampZoomOptions.maxScale,W=function(e){function t(e){var n;return Object(v.a)(this,t),(n=Object(y.a)(this,Object(_.a)(t).call(this,e))).state={data:[]},n}return Object(x.a)(t,e),Object(w.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e}},{key:"componentDidMount",value:function(){var e=this;j.a("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv").then((function(t){var n=j.j().key((function(e){return e.data})).entries(t),a=n[n.length-1].values,o=[];i=j.g().fitSize([k.map.width-50,k.map.height-50],e._rootNode).translate([k.map.width/2,k.map.height/2]).scale(3e3).center([12.368775000000001,42.9451139]),a.forEach((function(e){var t=i([e.long,e.lat]);e.x=t[0],e.y=t[1]}));for(var r=function(e){k.categories.forEach((function(t){for(var n=0;n<a[e][t];++n){var i={category:t,denominazione_regione:a[e].denominazione_regione,date:a[e].data,_x:a.find((function(t){return t.denominazione_regione===a[e].denominazione_regione})).x,_y:a.find((function(t){return t.denominazione_regione===a[e].denominazione_regione})).y,x:a.find((function(t){return t.denominazione_regione===a[e].denominazione_regione})).x+j.k(-50,50)(),y:a.find((function(t){return t.denominazione_regione===a[e].denominazione_regione})).y+j.k(-50,50)()};o.push(i)}}))},c=0;c<a.length;++c)r(c);e.setState({raw_data:a,data:o},(function(){var t=j.l(e._rootNode),n=t.append("g");t.call(j.m().extent([[0,0],[window.innerWidth,window.innerHeight]]).scaleExtent([k.clampZoomOptions.minScale,k.clampZoomOptions.maxScale]).on("zoom",(function(){n.attr("transform",j.b.transform)})));var i=n.selectAll("text").data(e.state.data).enter().append("text").attr("font-size",S+"px").text((function(e){return k.emoji_dictionary[e.category]})),a=window.prompt("Set the alpha decay of force simulation, once finished it will generate a JSON with the spatialized positions",.05);E.nodes(o).force("x",j.e((function(e){return e._x}))).force("y",j.f((function(e){return e._y}))).force("charge",j.c().strength(-.09)).alphaDecay(a).alpha(1).on("end",(function(){console.log("ended",o,E),r=!1,i.attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y}));for(var e=0;e<o.length;++e)console.log(e),o[e]._x=o[e].x,o[e]._y=o[e].y,delete o[e].index,delete o[e].vx,delete o[e].vy,delete o[e].x,delete o[e].y;var t=new Blob([JSON.stringify(o)],{type:"application/json;charset=utf-8"});O.a.saveAs(t,"covi-z.json")})).restart();var r=!0;!function e(){r&&(document.title="a = "+E.alpha(),i.attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y})),requestAnimationFrame(e))}(),document.addEventListener("keypress",function(){var e=Object(g.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"r"===t.key&&E.alpha(1).restart();case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))}))}},{key:"render",value:function(){return s.a.createElement("svg",{ref:this._setRef.bind(this),style:{width:"100%",height:"100%"}})}}]),t}(l.Component),C=n(16),D=n(1),N=n(59),Z=n(60),H=n.n(Z),R=window.innerWidth,A=window.innerHeight,P=window.devicePixelRatio||1,I=k.emoji.size,J=function(e){function t(e){var n;return Object(v.a)(this,t),(n=Object(y.a)(this,Object(_.a)(t).call(this,e))).loadData=n.loadData.bind(Object(C.a)(n)),n.state={textures:{}},n}return Object(x.a)(t,e),Object(w.a)(t,[{key:"loadData",value:function(){return Promise.all([j.i("./data/covi-z.json"),j.i("./data/regioni.geojson")])}},{key:"componentDidMount",value:function(){for(var e=this,t=document.querySelectorAll("#textures-generation>span"),n={},i=function(i){H()(t[i],{backgroundColor:null}).then((function(l){n[t[i].id]=l.toDataURL("image/png"),Object.keys(n).length===Object.keys(k.emoji_dictionary).length&&e.setState({textures:n},(function(){e.loadData().then((function(t){var n=t[0],i=t[1];a=new D.Application({width:R,height:A,backgroundColor:16448250,resolution:P,autoResize:!0}),e._rootNode.appendChild(a.view),(o=new N.a({center:new D.Point(-window.innerWidth/2,-window.innerHeight/2),passiveWheel:!1,stopPropagation:!0,divWheel:e._rootNode,screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:window.innerWidth,worldHeight:window.innerHeight,interaction:a.renderer.plugins.interaction})).clampZoom(k.clampZoomOptions).drag({pressDrag:!0,clampWheel:!0}).pinch().wheel(),a.stage.addChild(o),c=j.g().fitSize([k.map.width-50,k.map.height-50],e._rootNode).translate([k.map.width/2,k.map.height/2]).scale(3e3).center([12.368775000000001,42.9451139]);for(var l=0;l<i.features.length;l++){var s=i.features[l],d=new D.Graphics,u=j.h().projection(c).context(d);d.beginFill(16777215,1),d.lineStyle(.25,13421772),u(s),d.endFill(),o.addChild(d)}r=new D.Container,o.addChild(r);for(var m=0;m<n.length;++m){var h=D.Sprite.from(e.state.textures[n[m].category]);h.anchor.set(.5),h.x=n[m]._x,h.y=n[m]._y,h.scale.x=1/P/k.clampZoomOptions.maxScale,h.scale.y=1/P/k.clampZoomOptions.maxScale,r.addChild(h)}}))}))}))},l=0;l<t.length;++l)i(l)}},{key:"_setRef",value:function(e){this._rootNode=e}},{key:"render",value:function(){return s.a.createElement("div",{style:{width:"100%",height:"100%"},ref:this._setRef.bind(this)},s.a.createElement("div",{id:"textures-generation",style:{fontSize:I+"px",position:"absolute",top:"10px"}},Object.keys(k.emoji_dictionary).map((function(e){return s.a.createElement("span",{id:e,key:"emoji-".concat(e)},k.emoji_dictionary[e])}))))}}]),t}(l.Component);var B=function(){return s.a.createElement("div",{className:"App"},s.a.createElement(m.a,{basename:"/"},s.a.createElement(h.a,{path:"/svg"},s.a.createElement(W,null)),s.a.createElement(h.a,{path:"/pixi"},s.a.createElement(J,null)),s.a.createElement(h.a,{exact:!0,path:"/"},s.a.createElement("nav",null,s.a.createElement("ul",null,s.a.createElement("li",null,s.a.createElement(m.b,{to:"/svg"},"SVG Version")),s.a.createElement("li",null,s.a.createElement(m.b,{to:"/pixi"},"PIXIjs version")))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(s.a.createElement(B,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},82:function(e,t,n){e.exports=n(104)},87:function(e,t,n){},88:function(e,t,n){}},[[82,1,2]]]);
//# sourceMappingURL=main.6c6ed8b0.chunk.js.map