(this["webpackJsonpcovi-z"]=this["webpackJsonpcovi-z"]||[]).push([[0],{103:function(e,t,n){"use strict";n.r(t);var a,i,o=n(0),r=n.n(o),c=n(54),s=n.n(c),l=(n(86),n(20)),u=n(15),d=(n(87),n(4)),h=n(5),p=n(6),f=n(3),m=n(7),g=n(2),v=n(55),y=n.n(v),_={emoji:{size:20},clampZoomOptions:{minScale:.5,maxScale:10},emoji_dictionary:{dimessi_guariti:"\ud83c\udf40",isolamento_domiciliare:"\u26aa\ufe0f",ricoverati_con_sintomi:"\ud83c\udf3c",terapia_intensiva:"\ud83c\udf38",deceduti:"\ud83c\udf3a"},emoji_images_dictionary:{dimessi_guariti:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/four-leaf-clover_1f340.png",isolamento_domiciliare:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/blossom_1f33c.png",ricoverati_con_sintomi:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/sunflower_1f33b.png",terapia_intensiva:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/cherry-blossom_1f338.png",deceduti:"https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/144/whatsapp/238/hibiscus_1f33a.png"},categories:["deceduti","terapia_intensiva","ricoverati_con_sintomi","isolamento_domiciliare","dimessi_guariti"],map:{width:768,height:1024,scale:8e3}},x=_,w=g.f().stop(),b=x.emoji.size/x.clampZoomOptions.maxScale,k=[],E=JSON.parse(JSON.stringify(x.categories)),j=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(p.a)(this,Object(f.a)(t).call(this,e))).state={data:[]},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e,i=g.i().fitSize([x.map.width-50,x.map.height-50],this._rootNode).translate([x.map.width/2,x.map.height/2]).scale(x.map.scale).center([12.368775000000001,42.9451139])}},{key:"componentDidMount",value:function(){var e=this;g.a("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv").then((function(t){var n=g.k().key((function(e){return e.data})).entries(t);console.log(n);var o={};n.forEach((function(e){var t=e.key,n=e.values;n.forEach((function(e){var t=i([e.long,e.lat]);e.x=t[0],e.y=t[1]})),o[t]=[],n.forEach((function(e,n){x.categories.forEach((function(n){for(var a=0;a<e[n];++a){var i={id:e.denominazione_regione+"-"+n+"-"+a+1,category:n,denominazione_regione:e.denominazione_regione,date:e.data,_x:e.x,_y:e.y,x:e.x,y:e.y};o[t].push(i)}}))}))})),e.setState({data:o},(function(){var t=g.m(e._rootNode),n=t.append("g");var i=g.n().extent([[0,0],[window.innerWidth,window.innerHeight]]).scaleExtent([x.clampZoomOptions.minScale,2*x.clampZoomOptions.maxScale]).on("zoom",(function(){n.attr("transform",g.c.transform)}));t.call(i),t.call(i.transform,g.o.translate(-5,-340).scale(5)),a=n.selectAll("text"),w.nodes(k).tick(1e3).on("tick",(function(){document.title=w.alpha(),a.attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y}))})).force("x",g.g((function(e){return e._x}))).force("y",g.h((function(e){return e._y}))).force("charge",g.e().strength(-.05)).alphaDecay(.1).alphaMin(.1);var o=Object.keys(e.state.data);o=o.slice(0,5);!function t(){var n=o.shift();console.log(n);var a=e.state.data[n];console.log(a),E=JSON.parse(JSON.stringify(x.categories)),k=O(k,a,E.shift()),S(),w.force("collision",null),w.on("end",(function(){document.title="simulation ended",E.length>0?(k=O(k,a,E.shift()),S()):(document.title="running anticollision",console.log("running anticollision"),w.force("collision",g.d(x.emoji.size/x.clampZoomOptions.maxScale/2*.9).strength(.1)),w.alpha(1).restart().on("end",(function(){console.log("done anticollision, missing",o.length),o.length>0?(k.forEach((function(e){delete e.x,delete e.y,delete e.index,delete e.vx,delete e.vy,delete e.fx,delete e.fy})),k=[],t()):M(e.state.data)})))}))}()}))})),document.addEventListener("keypress",(function(e){"r"===e.key?w.alpha(1).restart():"\\"===e.key?w.alpha(1e-5).restart():"c"===e.key||99===e.keyCode?(k.forEach((function(e){e.fx=null,e.fy=null})),w.force("collision",g.d(x.emoji.size/x.clampZoomOptions.maxScale/2*.9).strength(.1)),w.alpha(1).restart()):"d"===e.key&&M(k)}))}},{key:"render",value:function(){return r.a.createElement("svg",{ref:this._setRef.bind(this),style:{width:"100%",height:"100%"}})}}]),t}(o.Component),O=function(e,t,n){e.forEach((function(e){e.fx=e.x,e.fy=e.y}));var a=t.filter((function(e){return e.category===n})),i=360/a.length*20,o=2*Math.sqrt((a.length+e.length)/Math.PI);return a.forEach((function(e,t){e.x=e._x+Math.cos(Math.PI/180*t*i)*(o+t/80)+g.l(-5,5)(),e.y=e._y+Math.sin(Math.PI/180*t*i)*(o+t/80)+g.l(-5,5)()})),e.concat(a)},S=function(){(a=a.data(k,(function(e){return e.id}))).exit().remove(),a=a.enter().append("text").classed("node",!0).attr("font-size",b+"px").text((function(e){return x.emoji_dictionary[e.category]})).attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y})).call(g.b().on("start",z).on("drag",C).on("end",N)).merge(a),w.nodes(k).alpha(1).restart()};function z(e){g.c.active||w.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function C(e){e.fx=g.c.x,e.fy=g.c.y}function N(e){g.c.active||w.alphaTarget(0),e.fx=null,e.fy=null}function M(e){var t=new Blob([JSON.stringify(e)],{type:"application/json;charset=utf-8"});y.a.saveAs(t,"covi-z-storico.json")}var D,R,A,P,W,Z=n(13),I=n(1),J=n(57),B={},V=window.devicePixelRatio||1,H=g.f().force("x",g.g((function(e){return e.x}))).force("y",g.h((function(e){return e.y}))).stop(),T=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(p.a)(this,Object(f.a)(t).call(this,e))).updateSprites=n.updateSprites.bind(Object(Z.a)(n)),n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e}},{key:"updateSprites",value:function(){var e=A.children.map((function(e){return e._data_.id})),t=this.props.data.map((function(e){return e.id})),n=this.props.data.filter((function(t){return-1===e.indexOf(t.id)})),a=this.props.data.filter((function(t){return-1!==e.indexOf(t.id)})),i=A.children.filter((function(e){return-1===t.indexOf(e._data_.id)}));console.log(this.props.data.length,n.length,i.length);for(var o=function(e){var t=I.Sprite.from(B[n[e].category]);t.anchor.set(.5),t.scale.x=.35,t.scale.y=.35,t._data_=n[e],t.interactive=!0,t.on("mousedown",(function(){return console.log(t)})),A.addChild(t)},r=0;r<n.length;++r)o(r);for(var c=0;c<a.length;++c){var s=e.indexOf(a[c].id);A.children[s]._data_=a[c]}for(var l=0;l<i.length;++l)A.removeChild(i[l]);this.props.data.length!==A.children.length&&(console.warn("Problem in sprites update"),console.warn("total data:",this.props.data.length),console.warn("total sprites:",A.children.length)),this.repositionSprites()}},{key:"repositionSprites",value:function(){var e=this,t=!0;H.nodes(this.props.data),"stripes"===this.props.model?(H.force("x").x((function(t){return t["".concat(e.props.model.charAt(0),"_x")]*P})),H.force("y").y((function(t){return t["".concat(e.props.model.charAt(0),"_y")]*W}))):(H.force("x").x((function(t){return t["".concat(e.props.model.charAt(0),"_x")]})),H.force("y").y((function(t){return t["".concat(e.props.model.charAt(0),"_y")]}))),H.on("end",(function(){console.log("simulation ended for",e.props.model),t=!1})),H.alpha(1),H.restart(),function e(){for(var n=0;n<A.children.length;n++)A.children[n].x=A.children[n]._data_.x,A.children[n].y=A.children[n]._data_.y;t&&requestAnimationFrame(e)}()}},{key:"componentDidMount",value:function(){P=this._rootNode.getBoundingClientRect().width,W=this._rootNode.getBoundingClientRect().height,D=new I.Application({width:P,height:W,backgroundColor:16448250,resolution:V,autoResize:!0}),this._rootNode.appendChild(D.view),(R=new J.a({center:new I.Point(-P/2,-W/2),passiveWheel:!1,stopPropagation:!0,divWheel:this._rootNode,screenWidth:P,screenHeight:W,worldWidth:P,worldHeight:W,interaction:D.renderer.plugins.interaction})).clampZoom(x.clampZoomOptions).drag({pressDrag:!0,clampWheel:!0}).pinch().wheel(),D.stage.addChild(R),A=new I.Container,R.addChild(A),x.categories.forEach((function(e){var t=I.Texture.from("./".concat(e,".png"));B[e]=t})),this.updateSprites()}},{key:"componentDidUpdate",value:function(e){e.data!==this.props.data?this.updateSprites():e.model!==this.props.model&&this.repositionSprites()}},{key:"render",value:function(){return r.a.createElement("div",{style:{width:"100vw",height:"100vh"},ref:this._setRef.bind(this)})}}]),t}(o.Component),q=n(31),F=n.n(q),G=n(58),L=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(p.a)(this,Object(f.a)(t).call(this,e))).state={data:null},n.changeDate=n.changeDate.bind(Object(Z.a)(n)),n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"_setRef",value:function(e){this._rootNode=e}},{key:"changeDate",value:function(e){e<0?e=this.state.dates.length-1:e>this.state.dates.length-1&&(e=0);var t=this.state.dates[e];this.setState({current_date:t,current_date_index:e,data_day:this.state.data[t]})}},{key:"changeModel",value:function(e){this.setState({model:e})}},{key:"componentDidMount",value:function(){var e=Object(G.a)(F.a.mark((function e(){var t,n,a,i;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.j("./data/covi-z-storico.json");case 2:return t=e.sent,n=Object.keys(t),a=n.length-1,i=t[n[a]],e.next=8,this.setState({data:t,dates:n,current_date:n[a],current_date_index:a,data_day:i,model:"stripes"});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",{ref:this._setRef.bind(this)},r.a.createElement("p",null,r.a.createElement("input",{type:"button",name:"prev-date",value:"\u23ea",onClick:function(){return e.changeDate(e.state.current_date_index-1)}}),r.a.createElement("input",{type:"button",name:"prev-date",value:"\u23e9",onClick:function(){return e.changeDate(e.state.current_date_index+1)}}),r.a.createElement("input",{type:"button",name:"bands",value:"\ud83d\uddbc",onClick:function(){return e.changeModel("stripes")}}),r.a.createElement("input",{type:"button",name:"bunch",value:"\ud83d\udc90",onClick:function(){return e.changeModel("bunches")}}),r.a.createElement("input",{type:"button",name:"clusters",value:"\ud83c\udfaf",onClick:function(){return e.changeModel("clusters")}})),this.state.data&&r.a.createElement(T,{data:this.state.data_day,model:this.state.model}))}}]),t}(o.Component);var U=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(l.a,{basename:"/"},r.a.createElement(u.a,{exact:!0,path:"/"},r.a.createElement("nav",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l.b,{to:"/svg"},"SVG Version")),r.a.createElement("li",null,r.a.createElement(l.b,{to:"/pixi"},"PIXIjs version")),r.a.createElement("li",null,r.a.createElement(l.b,{to:"/viz"},"Visualization"))))),r.a.createElement(u.a,{path:"/svg"},r.a.createElement(j,null)),r.a.createElement(u.a,{path:"/pixi"},r.a.createElement(T,null)),r.a.createElement(u.a,{path:"/viz"},r.a.createElement(L,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(U,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},81:function(e,t,n){e.exports=n(103)},86:function(e,t,n){},87:function(e,t,n){}},[[81,1,2]]]);
//# sourceMappingURL=main.40526874.chunk.js.map